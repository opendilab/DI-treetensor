

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Stack Structured Data &mdash; DI-treetensor 0.3.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Customized Operations For Different Fields" href="../operation/index.html" />
    <link rel="prev" title="Plugins" href="../../tutorials/plugins/index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> DI-treetensor
          

          
          </a>

          
            
            
              <div class="version">
                0.3.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/installation/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/quick_start/index.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/plugins/index.html">Plugins</a></li>
</ul>
<p><span class="caption-text">Best Practice</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Stack Structured Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#stack-with-native-pytorch-api">Stack With Native PyTorch API</a></li>
<li class="toctree-l2"><a class="reference internal" href="#stack-with-treetensor-api">Stack With TreeTensor API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../operation/index.html">Customized Operations For Different Fields</a></li>
</ul>
<p><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api_doc/common/index.html">treetensor.common</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_doc/config/index.html">treetensor.config</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_doc/numpy/index.html">treetensor.numpy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_doc/torch/index.html">treetensor.torch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_doc/utils/index.html">treetensor.utils</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">DI-treetensor</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Stack Structured Data</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/best_practice/stack/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
    
    
  <section id="stack-structured-data">
<h1>Stack Structured Data<a class="headerlink" href="#stack-structured-data" title="Permalink to this headline">¶</a></h1>
<p>When the tensors form the tree structures, they are often needed to be stacked together, like the <a class="reference internal" href="../../api_doc/torch/funcs.stack.auto.html#torch.stack" title="torch.stack"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.stack()</span></code></a> implemented in torch.</p>
<section id="stack-with-native-pytorch-api">
<h2>Stack With Native PyTorch API<a class="headerlink" href="#stack-with-native-pytorch-api" title="Permalink to this headline">¶</a></h2>
<p>Here is the common code implement with native pytorch API.</p>
<div class="highlight-python notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span></pre></div></td><td class="code"><div><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="n">B</span> <span class="o">=</span> <span class="mi">4</span>


<span class="k">def</span> <span class="nf">get_item</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;obs&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;scalar&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">12</span><span class="p">),</span>
            <span class="s1">&#39;image&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span>
        <span class="p">},</span>
        <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,)),</span>
        <span class="s1">&#39;reward&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
        <span class="s1">&#39;done&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">}</span>


<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_item</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">B</span><span class="p">)]</span>


<span class="c1"># execute `stack` op</span>
<span class="k">def</span> <span class="nf">stack</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dim</span><span class="p">):</span>
    <span class="n">elem</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">stack</span><span class="p">([</span><span class="n">item</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">],</span> <span class="n">dim</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">elem</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">BoolTensor</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;not support elem type: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">elem</span><span class="p">)))</span>


<span class="n">stacked_data</span> <span class="o">=</span> <span class="n">stack</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># validate</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stacked_data</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">stacked_data</span><span class="p">[</span><span class="s1">&#39;obs&#39;</span><span class="p">][</span><span class="s1">&#39;image&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">stacked_data</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">stacked_data</span><span class="p">[</span><span class="s1">&#39;reward&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">stacked_data</span><span class="p">[</span><span class="s1">&#39;done&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">B</span><span class="p">,)</span>
<span class="k">assert</span> <span class="n">stacked_data</span><span class="p">[</span><span class="s1">&#39;done&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">torch</span><span class="o">.</span><span class="n">bool</span>
</pre></div></td></tr></table></div>
</div>
<p>The output should be like below, and the assertion statements can be all passed.</p>
<div class="highlight-text notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span></pre></div></td><td class="code"><div><pre><span></span>{&#39;obs&#39;: {&#39;scalar&#39;: tensor([[ 0.1760,  0.8024, -1.2974, -0.6028,  0.2067,  1.4612,  0.7636, -0.9304,
          0.9686, -0.2472,  0.5177, -0.5534],
        [-1.7578, -2.9445, -0.0268,  2.1303,  1.7847, -0.0920, -1.0582, -0.3638,
          1.0788, -0.5475, -0.4759,  0.0797],
        [-0.0375, -0.9557, -0.3232, -0.7686, -0.8312,  0.4253, -0.9777, -0.6686,
         -0.0353, -0.3217, -0.7473, -0.7875],
        [-0.1556, -0.1480, -0.2066,  0.1052, -0.4339,  0.0136, -0.0584, -0.2551,
          1.8536,  0.0701,  0.3271, -0.9330]]), &#39;image&#39;: tensor([[[[ 3.1106e-01, -7.0974e-01,  1.5592e+00,  ..., -2.1741e-01,
            1.4329e+00, -1.7700e+00],
          [-2.9810e-01,  8.7788e-02,  1.0145e-01,  ...,  1.6314e+00,
           -4.5696e-01,  1.0641e+00],
          [-9.8754e-01,  1.1409e+00, -4.9893e-01,  ...,  7.0917e-02,
           -3.5803e-01,  1.4125e+00],
          ...,
          [-9.7863e-02, -1.2711e+00, -2.2408e-01,  ..., -2.4928e+00,
           -1.0648e+00, -1.6512e+00],
          [ 1.0188e+00, -3.4235e-01,  1.0920e+00,  ...,  1.1768e+00,
           -5.5641e-01,  2.2038e-01],
          [-1.7007e+00, -9.1730e-01, -3.8185e-01,  ...,  7.8250e-01,
            8.3398e-01,  2.4430e-01]],

         [[-5.7519e-01,  1.0115e+00,  1.4528e+00,  ...,  7.5697e-01,
           -9.2289e-01,  1.2424e+00],
          [-6.2928e-01,  4.4095e-01,  3.6029e-01,  ..., -4.9456e-01,
            1.4199e+00, -1.0726e+00],
          [-5.9943e-01,  6.9264e-01, -1.0796e+00,  ...,  7.7371e-02,
            3.4213e-01,  5.4104e-01],
          ...,
          [ 5.9678e-01, -6.9447e-01,  1.1542e+00,  ...,  7.9093e-01,
            8.9777e-01,  1.5268e+00],
          [-2.8555e-01, -8.9654e-01, -3.6381e-01,  ...,  1.4467e-01,
           -9.9600e-01, -1.3798e+00],
          [-5.1188e-01, -6.8238e-01,  1.4857e-01,  ..., -2.9753e-01,
            1.0201e+00, -1.2151e+00]],

         [[ 1.5677e-01,  3.5834e-01,  5.6950e-01,  ...,  4.8795e-01,
           -7.9412e-02,  7.2268e-02],
          [ 4.0979e-01, -1.4059e-01, -1.4274e-01,  ...,  1.6982e+00,
           -4.7995e-01, -2.7123e-01],
          [-1.5321e+00, -4.8307e-01, -4.1155e-01,  ..., -1.6153e-01,
            8.8707e-01,  3.4784e-02],
          ...,
          [-7.5641e-02, -2.8958e-01, -6.7870e-01,  ..., -1.1182e+00,
            1.9861e-01, -2.1365e-01],
          [ 7.9963e-01, -4.9546e-01,  2.0379e-01,  ..., -6.7645e-01,
           -1.0503e+00,  5.3487e-01],
          [ 8.8446e-01,  1.1153e+00,  1.8821e+00,  ..., -1.5739e-01,
           -1.9404e-01, -1.5464e+00]]],


        [[[ 1.1453e+00,  2.3281e+00, -2.5554e-01,  ...,  7.7216e-01,
           -1.7526e+00,  1.0169e+00],
          [-2.9032e-01,  2.2320e-01, -1.6763e+00,  ..., -3.5354e-01,
           -3.3208e-01, -8.6156e-01],
          [ 4.2732e-01,  1.0068e+00, -8.3470e-01,  ..., -3.1158e+00,
            6.3162e-01,  9.4063e-01],
          ...,
          [-6.9164e-01,  6.4776e-01, -1.2373e+00,  ...,  3.5409e-01,
           -2.3132e-01, -1.5480e-02],
          [-5.7597e-01,  1.1228e+00,  9.8495e-01,  ...,  4.4901e-01,
            1.0516e-01,  9.0475e-01],
          [-6.9914e-01, -2.2957e-01, -1.0054e+00,  ..., -8.6725e-01,
           -8.5975e-01, -6.6549e-01]],

         [[-6.4811e-01, -9.3691e-01,  2.1994e+00,  ...,  7.9097e-01,
           -1.1136e+00, -3.4260e-01],
          [-7.3341e-01,  6.4487e-01, -1.2202e+00,  ...,  7.4318e-01,
           -4.7366e-01, -1.9106e-01],
          [-1.0667e-01, -7.8877e-01,  4.2807e-01,  ..., -9.3522e-01,
            3.8979e-01,  1.7764e+00],
          ...,
          [ 6.4016e-01, -7.2386e-01,  6.1534e-01,  ..., -1.3013e-03,
            2.8229e+00, -4.5518e-02],
          [-2.8468e-01,  6.9237e-01, -1.6557e-01,  ...,  9.6295e-01,
           -5.9430e-03, -9.1089e-02],
          [-1.5844e+00, -3.9548e-01,  6.1881e-01,  ...,  6.1204e-01,
           -3.6211e-01, -8.2531e-02]],

         [[ 4.2844e-01,  8.8469e-02,  9.3143e-01,  ...,  1.5234e+00,
            9.9013e-01, -3.0880e-01],
          [-2.4730e-01, -1.6519e+00, -1.2518e+00,  ..., -4.2817e-01,
           -2.3860e+00,  1.2425e+00],
          [ 1.0701e+00,  4.4889e-01,  3.8467e-01,  ...,  4.1740e-01,
            1.6805e+00,  8.9324e-02],
          ...,
          [-1.7353e-01,  2.3420e+00,  6.3641e-01,  ..., -7.0919e-01,
            2.3564e-01, -5.6701e-01],
          [-3.4999e-02, -5.8752e-01,  1.0083e+00,  ...,  2.1248e-01,
           -5.2197e-01, -3.7519e-01],
          [ 9.3693e-03, -3.7635e-01, -2.3582e+00,  ...,  3.7393e-01,
            1.7649e-02,  9.0191e-01]]],


        [[[-1.7595e+00,  1.7305e+00,  4.4810e-01,  ...,  1.0310e+00,
           -2.3026e-01,  3.1868e-01],
          [-1.3518e+00,  4.8720e-01, -7.1499e-01,  ..., -1.7516e+00,
           -1.0371e+00,  1.5202e-01],
          [ 8.6792e-03, -7.8287e-01, -7.7010e-02,  ...,  1.0136e+00,
            8.6846e-02,  1.4692e-01],
          ...,
          [-2.1214e+00, -9.7586e-01, -1.1211e+00,  ...,  9.4041e-02,
            5.3462e-01, -1.1447e-01],
          [-6.4442e-01,  4.2430e-01,  1.1698e-01,  ..., -8.5588e-01,
            1.0410e+00,  2.7459e-01],
          [ 1.1889e+00, -3.0577e-01,  1.8201e+00,  ...,  4.2163e-01,
           -1.2731e+00, -7.8618e-02]],

         [[-9.9885e-01,  5.4489e-01,  8.1910e-02,  ..., -9.5909e-01,
           -7.7284e-01, -5.2311e-01],
          [-8.1318e-01, -5.2157e-01,  1.3696e-01,  ..., -1.6540e+00,
            1.4430e+00, -1.2868e+00],
          [-9.0738e-01,  1.3979e+00,  5.1453e-01,  ...,  1.5574e+00,
            1.4365e-01,  1.2117e+00],
          ...,
          [ 2.4903e-01,  2.0928e-01, -1.5959e+00,  ...,  5.6170e-01,
            4.4804e-01, -5.5672e-01],
          [-8.1855e-02,  1.1778e+00,  7.3918e-01,  ...,  7.3185e-01,
           -1.0926e+00,  2.3598e+00],
          [-5.3023e-01, -1.1329e+00,  1.3332e+00,  ..., -8.0291e-01,
            7.3203e-01, -1.7524e+00]],

         [[ 8.5651e-01, -5.8947e-01, -3.0021e-01,  ..., -2.3961e+00,
           -1.2329e+00, -1.1270e+00],
          [-2.9078e-01, -1.7337e+00,  1.0945e+00,  ...,  3.7265e-01,
           -1.5339e-01,  1.7227e+00],
          [-1.7264e-01,  1.1572e+00,  1.0605e+00,  ..., -8.9517e-01,
           -1.8249e+00, -1.7135e+00],
          ...,
          [-1.7706e+00,  8.8858e-01,  6.5755e-02,  ...,  2.3313e-01,
            1.4887e-01, -7.0730e-01],
          [-2.2690e-02, -1.2462e-01,  2.2581e-01,  ...,  2.1971e-01,
            2.2275e-01, -1.4493e+00],
          [-1.4938e+00, -4.7329e-01, -2.2890e-01,  ...,  9.9420e-01,
            7.9615e-01,  1.0894e+00]]],


        [[[-2.2037e-01, -5.1810e-01,  1.8149e-01,  ..., -1.0008e+00,
            1.0439e+00,  9.8957e-02],
          [ 9.2801e-01, -6.6506e-01, -1.3082e+00,  ..., -2.7162e-01,
            6.9969e-01,  5.9124e-01],
          [ 2.0255e+00,  7.1728e-01, -2.0690e-01,  ..., -4.1714e-01,
           -2.2262e+00,  9.9434e-01],
          ...,
          [ 4.7449e-02, -5.1502e-01,  7.6532e-01,  ...,  2.4845e+00,
           -4.0453e-01,  8.0380e-01],
          [-1.9362e+00, -1.3264e+00,  1.0821e+00,  ..., -6.2569e-01,
            1.2915e+00,  2.9520e-01],
          [-1.2888e+00, -1.4295e+00,  9.1680e-01,  ...,  1.1846e-01,
            1.1258e+00, -1.7420e+00]],

         [[-2.2836e+00, -7.9267e-01,  1.4794e-02,  ...,  2.1157e-01,
           -1.3722e+00,  4.4653e-01],
          [ 1.8527e-01,  5.5525e-01, -1.1020e+00,  ..., -1.4486e+00,
            9.1024e-01, -1.5887e+00],
          [ 7.3135e-01, -6.8111e-02, -7.8652e-01,  ...,  9.6727e-01,
           -1.9118e+00, -1.6347e-02],
          ...,
          [-2.5426e-01, -1.2619e+00, -4.4015e-02,  ...,  1.2671e+00,
            1.9866e-01,  6.7027e-01],
          [ 3.0491e-01, -1.0141e+00, -1.0523e+00,  ...,  7.1798e-01,
            7.7070e-01, -6.8993e-02],
          [ 5.0615e-01,  8.9507e-01, -1.6362e-01,  ..., -1.6089e+00,
            7.3867e-02, -8.5676e-01]],

         [[ 5.5838e-01,  1.0104e+00, -4.6811e-01,  ..., -1.3340e-01,
           -1.2190e+00, -9.5639e-01],
          [-9.1636e-02, -8.9571e-01, -1.9659e+00,  ...,  1.7888e+00,
           -4.6215e-01,  1.0825e+00],
          [-4.9051e-02,  9.7738e-01, -1.1367e+00,  ..., -1.1971e+00,
           -8.7900e-01, -3.0000e-01],
          ...,
          [ 2.3815e+00,  1.2845e+00, -7.8598e-01,  ...,  1.6790e+00,
            1.1096e+00,  2.0718e+00],
          [ 1.6558e+00, -1.0411e+00, -2.4788e+00,  ..., -5.7318e-01,
            1.8927e+00,  6.9408e-01],
          [ 7.4287e-02,  1.7487e-01, -5.1108e-01,  ...,  7.2883e-01,
            1.9681e+00,  4.0544e-02]]]])}, &#39;action&#39;: tensor([[7],
        [0],
        [8],
        [4]]), &#39;reward&#39;: tensor([[0.7354],
        [0.6936],
        [0.3661],
        [0.0601]]), &#39;done&#39;: tensor([False, False, False, False])}
</pre></div></td></tr></table></div>
</div>
<p>We can see that the structure process function need to be fully implemented (like the function <code class="docutils literal notranslate"><span class="pre">stack</span></code>). This code is actually not clear, and due to hard coding, if you need to support more data types (such as integer), you must make special modifications to the function.</p>
</section>
<section id="stack-with-treetensor-api">
<h2>Stack With TreeTensor API<a class="headerlink" href="#stack-with-treetensor-api" title="Permalink to this headline">¶</a></h2>
<p>The same workflow can be implemented with treetensor API like the code below.</p>
<div class="highlight-python notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="kn">import</span> <span class="nn">treetensor.torch</span> <span class="k">as</span> <span class="nn">ttorch</span>

<span class="n">B</span> <span class="o">=</span> <span class="mi">4</span>


<span class="k">def</span> <span class="nf">get_item</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;obs&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;scalar&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">12</span><span class="p">),</span>
            <span class="s1">&#39;image&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span>
        <span class="p">},</span>
        <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,)),</span>
        <span class="s1">&#39;reward&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
        <span class="s1">&#39;done&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">}</span>


<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_item</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">B</span><span class="p">)]</span>
<span class="c1"># execute `stack` op</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">ttorch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
<span class="n">stacked_data</span> <span class="o">=</span> <span class="n">ttorch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># validate</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stacked_data</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">stacked_data</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">stacked_data</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">stacked_data</span><span class="o">.</span><span class="n">reward</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">stacked_data</span><span class="o">.</span><span class="n">done</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">B</span><span class="p">,)</span>
<span class="k">assert</span> <span class="n">stacked_data</span><span class="o">.</span><span class="n">done</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">torch</span><span class="o">.</span><span class="n">bool</span>
</pre></div></td></tr></table></div>
</div>
<p>The output should be like below, and the assertion statements can be all passed as well.</p>
<div class="highlight-text notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span></pre></div></td><td class="code"><div><pre><span></span>&lt;Tensor 0x7fd4bc8f1510&gt;
├── &#39;action&#39; --&gt; tensor([[6],
│                        [4],
│                        [5],
│                        [7]])
├── &#39;done&#39; --&gt; tensor([False, False, False, False])
├── &#39;obs&#39; --&gt; &lt;Tensor 0x7fd4bc8f1610&gt;
│   ├── &#39;image&#39; --&gt; tensor([[[[ 0.3610,  0.6402,  1.3307,  ..., -0.7356,  2.3843, -0.5625],
│   │                         [ 1.5944, -0.1074, -0.6550,  ..., -0.9967, -1.8714, -0.4321],
│   │                         [-0.1176,  0.2242, -0.3089,  ...,  0.0459, -1.5837, -1.5197],
│   │                         ...,
│   │                         [-0.0130, -2.3549, -0.2139,  ...,  0.4480,  0.2421, -0.4776],
│   │                         [-1.2198,  0.5358,  0.0427,  ...,  1.3942,  0.7974,  0.2839],
│   │                         [-0.2208,  1.5614, -0.4239,  ...,  0.4281,  0.2344,  0.2257]],
│   │               
│   │                        [[-0.2561,  2.3511, -0.2288,  ..., -0.8301, -1.0205,  1.0108],
│   │                         [ 0.7589,  0.0622,  0.4547,  ..., -0.6394, -1.2318, -1.0268],
│   │                         [ 0.6601, -0.7820,  1.0321,  ...,  0.0663, -0.2909,  0.8841],
│   │                         ...,
│   │                         [ 1.0647,  1.5097, -1.0161,  ..., -0.0978, -1.3597, -0.0159],
│   │                         [-0.1348,  0.1335, -0.2815,  ...,  0.0203,  0.8146,  0.1015],
│   │                         [-0.1622,  0.5087, -0.2393,  ..., -0.7682,  0.1814, -1.7834]],
│   │               
│   │                        [[ 0.6026,  0.4195, -0.0244,  ..., -0.3671,  0.1988, -0.9452],
│   │                         [-0.6739,  1.3629,  0.8270,  ..., -0.2424,  0.6358,  0.6520],
│   │                         [-1.8059,  1.6918, -0.7719,  ...,  0.0710,  0.0664, -1.0111],
│   │                         ...,
│   │                         [ 0.9698,  1.9273,  1.1155,  ...,  0.8426,  0.8575, -2.1532],
│   │                         [-1.3225,  1.7166,  0.5780,  ..., -0.4311,  1.3313, -1.0747],
│   │                         [-0.5875, -0.1307,  1.0049,  ..., -0.1280, -1.7793,  0.1367]]],
│   │               
│   │               
│   │                       [[[ 0.3558,  0.4007, -0.3601,  ...,  0.9431, -0.1492,  1.2411],
│   │                         [-0.8442, -0.9869,  1.2562,  ...,  0.4425, -0.6764,  1.4254],
│   │                         [ 1.5474, -1.8971,  0.9604,  ..., -0.5201, -0.1109,  0.3850],
│   │                         ...,
│   │                         [-1.4989,  0.2635, -0.3118,  ..., -0.1216,  1.1977, -0.0351],
│   │                         [-1.6607,  0.2618,  0.7948,  ...,  0.2179,  0.4358, -0.0125],
│   │                         [ 1.3609,  0.6849, -1.0944,  ...,  2.0292,  1.7230, -0.4161]],
│   │               
│   │                        [[-0.8791, -0.9913, -2.4579,  ...,  0.4130, -0.8065, -0.7757],
│   │                         [-0.4774,  1.5989,  0.2238,  ..., -0.4837, -0.7030,  0.0330],
│   │                         [-1.3034, -1.5288,  0.3965,  ...,  0.7472,  0.0752, -0.2631],
│   │                         ...,
│   │                         [ 0.7852,  0.3387,  1.0999,  ...,  0.7230,  0.3416,  1.3397],
│   │                         [ 0.1095, -0.6697,  0.7502,  ..., -0.4047, -0.7261, -0.8906],
│   │                         [ 1.2129, -0.5711, -0.5946,  ..., -1.4631, -0.0699,  0.4114]],
│   │               
│   │                        [[ 0.7532, -0.5908, -0.2706,  ...,  0.5137, -2.4686, -0.9745],
│   │                         [ 0.6427, -0.9629, -0.1416,  ...,  0.3804, -0.3309, -0.1268],
│   │                         [ 0.9498, -0.1441, -0.1155,  ...,  0.3134,  0.3851,  0.3986],
│   │                         ...,
│   │                         [ 1.5149, -0.2976, -0.9906,  ...,  0.6204,  1.2600,  1.0819],
│   │                         [ 0.6862,  0.0495, -0.1224,  ...,  0.8038, -1.5297,  0.1328],
│   │                         [ 0.6036,  0.3784,  0.9200,  ..., -0.5328, -0.4390,  0.8682]]],
│   │               
│   │               
│   │                       [[[ 0.3746, -1.3339, -0.9514,  ...,  0.0045, -1.6211,  0.3113],
│   │                         [-0.0126, -0.6175, -1.3726,  ..., -0.0972,  0.6920, -0.1045],
│   │                         [ 0.6905,  1.5522,  0.0876,  ...,  1.7718,  0.2486, -0.6931],
│   │                         ...,
│   │                         [-1.1443,  0.3209,  0.4669,  ..., -1.4119, -0.0146, -1.5787],
│   │                         [-0.6874, -1.5592, -0.4085,  ..., -0.3859, -0.1706,  0.6137],
│   │                         [ 0.1256,  0.2324,  2.0461,  ...,  0.6630,  0.2421,  0.8189]],
│   │               
│   │                        [[-0.5020,  1.0865,  0.2947,  ...,  0.6526,  0.9990, -0.4165],
│   │                         [ 1.1692, -1.9011, -0.7617,  ..., -0.0328,  0.1192, -1.2533],
│   │                         [-0.0148,  2.2815, -0.9816,  ..., -0.3280,  0.4691, -0.9531],
│   │                         ...,
│   │                         [ 0.0752, -1.6205, -0.4297,  ...,  1.2976,  0.1658,  0.3428],
│   │                         [-1.0805, -0.0807,  0.6685,  ..., -1.2547, -1.0440,  1.3532],
│   │                         [ 0.0953,  0.8122,  0.3690,  ...,  0.3387, -0.1580, -1.4663]],
│   │               
│   │                        [[-0.8673, -1.7920, -0.7492,  ..., -0.3029,  1.5698,  0.5610],
│   │                         [ 0.7115, -0.6908,  0.9886,  ..., -0.9736, -0.2470,  2.3489],
│   │                         [-1.9368,  0.6800, -0.3294,  ..., -0.3380,  1.1733,  0.5138],
│   │                         ...,
│   │                         [-0.8317,  0.4192,  1.5154,  ...,  0.0465, -0.7650, -1.3925],
│   │                         [ 0.2209,  0.6799, -0.2861,  ...,  0.2626, -1.1477,  0.0528],
│   │                         [ 2.0261,  0.5329,  1.0694,  ...,  0.4041, -1.3291, -1.0149]]],
│   │               
│   │               
│   │                       [[[ 1.0276, -0.1492, -1.2031,  ..., -1.5099, -0.7605,  0.0100],
│   │                         [-0.6554,  1.2655,  0.2829,  ...,  0.6204, -0.9505, -1.1891],
│   │                         [-0.0712, -2.1708,  0.1736,  ...,  1.7035, -0.6708, -0.2293],
│   │                         ...,
│   │                         [ 0.0802, -1.7275,  0.7411,  ...,  1.5003,  0.3502,  0.5489],
│   │                         [-1.2665, -0.0517, -0.3768,  ..., -1.0179, -1.2368,  0.1252],
│   │                         [ 0.2072,  1.4721,  0.1905,  ..., -0.8760,  0.8727,  0.6292]],
│   │               
│   │                        [[-0.9524,  0.2612,  0.2722,  ..., -0.2976, -0.0490, -1.1324],
│   │                         [-1.0197,  0.0701, -1.5549,  ..., -2.1006, -0.4052, -0.8218],
│   │                         [ 0.1268,  0.6222,  0.6220,  ..., -0.1902,  0.2352, -0.6765],
│   │                         ...,
│   │                         [-1.1217, -0.7481, -0.6789,  ..., -0.3423,  0.3524, -1.9022],
│   │                         [ 0.6412, -0.3394,  0.1840,  ...,  0.2507,  0.3627, -0.3296],
│   │                         [-0.6504,  1.3496,  0.2103,  ...,  0.8672,  1.3598, -0.1481]],
│   │               
│   │                        [[-1.1850, -0.3091, -0.3122,  ...,  0.2753, -1.9519,  0.1257],
│   │                         [ 1.0105,  0.9249, -1.5892,  ..., -0.6448, -0.1156,  0.8982],
│   │                         [ 1.2026, -0.3711, -1.3203,  ...,  0.3256, -0.7933,  0.1748],
│   │                         ...,
│   │                         [-1.3570, -1.3066, -1.1416,  ..., -0.6219,  1.0847,  0.3297],
│   │                         [-0.3665,  1.7334, -1.9421,  ...,  0.6856,  0.7326, -0.0198],
│   │                         [-0.4696, -0.2876,  0.8318,  ...,  0.0314,  1.4784,  0.5859]]]])
│   └── &#39;scalar&#39; --&gt; tensor([[-3.0227, -0.0571,  1.7280, -0.8948,  0.6146,  1.1991, -0.4775, -0.3926,
│                             -0.3856,  0.4389,  2.3739, -0.6969],
│                            [ 1.2999,  0.7745,  0.6180, -0.6134, -0.5270,  0.8934, -0.8165,  0.4472,
│                              0.7394, -1.1918, -2.9392,  1.0312],
│                            [-0.2425, -0.7289, -0.5554, -0.2012,  0.4275,  0.2583,  0.0507,  0.0562,
│                             -0.4705, -0.1839,  1.4414, -2.1245],
│                            [ 0.1225, -0.0768, -1.4001, -0.2187, -0.2976,  0.5658, -1.2302,  1.4431,
│                             -1.0798, -0.8298,  0.8339, -0.9523]])
└── &#39;reward&#39; --&gt; tensor([[0.2783],
                         [0.3177],
                         [0.4911],
                         [0.0235]])
</pre></div></td></tr></table></div>
</div>
<p>This code looks much simpler and clearer.</p>
</section>
</section>



           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../operation/index.html" class="btn btn-neutral float-right" title="Customized Operations For Different Fields" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../../tutorials/plugins/index.html" class="btn btn-neutral float-left" title="Plugins" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2022, HansBug, DI-engine&#39;s Contributors

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
    <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: dev/py310
    <span class="fa fa-caret-down"></span>
  </span>
        <div class="rst-other-versions">
                <dl>
                    <dt>Tags</dt>
                        <dd><a href="../../../../v0.2.1/best_practice/stack/index.html">v0.2.1</a></dd>
                        <dd><a href="../../../../v0.3.0/best_practice/stack/index.html">v0.3.0</a></dd>
                </dl>
                <dl>
                    <dt>Branches</dt>
                        <dd><a href="index.html">dev/py310</a></dd>
                        <dd><a href="../../../stream/best_practice/stack/index.html">dev/stream</a></dd>
                        <dd><a href="../../../../main/best_practice/stack/index.html">main</a></dd>
                        <dd><a href="../../../../run/xdemos/best_practice/stack/index.html">run/xdemos</a></dd>
                </dl>
        </div>
    </div>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>