

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Stack Structured Data &mdash; DI-treetensor 0.4.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Customized Operations For Different Fields" href="../operation/index.html" />
    <link rel="prev" title="Plugins" href="../../tutorials/plugins/index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> DI-treetensor
          

          
          </a>

          
            
            
              <div class="version">
                0.4.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/installation/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/quick_start/index.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/plugins/index.html">Plugins</a></li>
</ul>
<p><span class="caption-text">Best Practice</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Stack Structured Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#stack-with-native-pytorch-api">Stack With Native PyTorch API</a></li>
<li class="toctree-l2"><a class="reference internal" href="#stack-with-treetensor-api">Stack With TreeTensor API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../operation/index.html">Customized Operations For Different Fields</a></li>
</ul>
<p><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api_doc/common/index.html">treetensor.common</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_doc/config/index.html">treetensor.config</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_doc/numpy/index.html">treetensor.numpy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_doc/torch/index.html">treetensor.torch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_doc/utils/index.html">treetensor.utils</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">DI-treetensor</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Stack Structured Data</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/best_practice/stack/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
    
    
  <section id="stack-structured-data">
<h1>Stack Structured Data<a class="headerlink" href="#stack-structured-data" title="Permalink to this headline">¶</a></h1>
<p>When the tensors form the tree structures, they are often needed to be stacked together, like the <a class="reference internal" href="../../api_doc/torch/funcs.stack.auto.html#torch.stack" title="torch.stack"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.stack()</span></code></a> implemented in torch.</p>
<section id="stack-with-native-pytorch-api">
<h2>Stack With Native PyTorch API<a class="headerlink" href="#stack-with-native-pytorch-api" title="Permalink to this headline">¶</a></h2>
<p>Here is the common code implement with native pytorch API.</p>
<div class="highlight-python notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span></pre></div></td><td class="code"><div><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="n">B</span> <span class="o">=</span> <span class="mi">4</span>


<span class="k">def</span> <span class="nf">get_item</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;obs&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;scalar&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">12</span><span class="p">),</span>
            <span class="s1">&#39;image&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span>
        <span class="p">},</span>
        <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,)),</span>
        <span class="s1">&#39;reward&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
        <span class="s1">&#39;done&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">}</span>


<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_item</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">B</span><span class="p">)]</span>


<span class="c1"># execute `stack` op</span>
<span class="k">def</span> <span class="nf">stack</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dim</span><span class="p">):</span>
    <span class="n">elem</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">stack</span><span class="p">([</span><span class="n">item</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">],</span> <span class="n">dim</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">elem</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">BoolTensor</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;not support elem type: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">elem</span><span class="p">)))</span>


<span class="n">stacked_data</span> <span class="o">=</span> <span class="n">stack</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># validate</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stacked_data</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">stacked_data</span><span class="p">[</span><span class="s1">&#39;obs&#39;</span><span class="p">][</span><span class="s1">&#39;image&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">stacked_data</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">stacked_data</span><span class="p">[</span><span class="s1">&#39;reward&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">stacked_data</span><span class="p">[</span><span class="s1">&#39;done&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">B</span><span class="p">,)</span>
<span class="k">assert</span> <span class="n">stacked_data</span><span class="p">[</span><span class="s1">&#39;done&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">torch</span><span class="o">.</span><span class="n">bool</span>
</pre></div></td></tr></table></div>
</div>
<p>The output should be like below, and the assertion statements can be all passed.</p>
<div class="highlight-text notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span></pre></div></td><td class="code"><div><pre><span></span>{&#39;obs&#39;: {&#39;scalar&#39;: tensor([[-0.9884, -0.7858, -0.1305,  0.9533, -0.2107, -1.3924,  0.6557, -1.6300,
          1.5624,  0.1592,  0.2163, -0.5032],
        [-0.2023, -0.5040, -0.4655,  0.4077,  0.2292,  0.1682,  1.0640,  1.0306,
         -1.1452,  1.8257, -0.7264,  0.7519],
        [ 0.6895,  0.8486, -1.1508,  0.5438,  0.3730, -1.3019, -0.0667,  1.4643,
         -1.9968, -0.2021, -0.1308,  1.6359],
        [ 2.0248,  0.0706, -0.1824,  0.8089, -0.6546, -0.4235,  0.3288, -0.7592,
          1.8397,  0.7571,  0.4347,  0.9026]]), &#39;image&#39;: tensor([[[[ 8.1576e-01,  1.0869e+00,  1.1781e+00,  ..., -6.5599e-01,
            2.4320e-01, -7.0310e-01],
          [ 1.9138e+00,  1.0374e+00, -1.1576e+00,  ..., -1.1933e+00,
            1.2704e+00,  7.6909e-01],
          [ 4.7608e-02,  6.8368e-01,  1.7866e+00,  ...,  6.1130e-01,
            1.0522e-01,  9.7834e-01],
          ...,
          [-1.5145e+00, -1.0707e+00,  6.2234e-01,  ..., -1.1549e+00,
           -8.1128e-01,  1.0645e+00],
          [ 4.5248e-01, -2.2580e-01, -1.0569e+00,  ..., -1.1049e-01,
           -6.6964e-01,  7.8078e-01],
          [-1.7158e-01, -4.1379e-01,  1.7767e+00,  ..., -7.8921e-01,
           -3.6207e-01,  1.1522e+00]],

         [[-1.2626e+00, -2.9780e-01, -7.2550e-01,  ...,  1.3770e+00,
            1.5973e-01, -7.2427e-04],
          [ 1.0182e+00,  7.6153e-01, -6.5871e-01,  ..., -1.1942e+00,
           -1.0238e+00, -5.9876e-01],
          [-6.6362e-01,  1.1064e-01,  2.6214e-01,  ...,  5.2106e-01,
            6.0283e-01,  3.5679e-01],
          ...,
          [-7.8276e-01, -3.2115e-02,  8.6722e-01,  ...,  1.0860e+00,
           -1.5019e-01, -6.5641e-02],
          [-1.3754e+00,  1.1759e+00,  8.5569e-01,  ..., -1.1856e+00,
            3.4894e-01,  1.5262e-01],
          [-2.6228e+00, -2.9622e-01,  1.7734e+00,  ...,  4.2698e-01,
           -1.2597e+00, -1.1439e+00]],

         [[ 1.8797e-02, -8.0171e-01,  5.5071e-01,  ...,  3.4384e-01,
            1.5567e+00,  5.7453e-01],
          [ 2.6296e+00, -8.8601e-03, -4.0903e-02,  ..., -1.3693e+00,
            6.7385e-01, -1.3266e+00],
          [-2.7092e-01,  9.5914e-01,  1.1750e+00,  ..., -1.3173e+00,
           -2.3809e+00, -7.7105e-01],
          ...,
          [-1.2312e+00, -3.4977e-01,  9.3459e-01,  ..., -2.5599e+00,
           -2.1854e-01,  2.0865e+00],
          [ 1.9818e-01, -8.8153e-01, -5.3344e-02,  ...,  9.5832e-02,
            2.1727e+00, -2.9039e-01],
          [-2.0198e-01,  2.4809e+00, -2.7024e-01,  ..., -7.7970e-02,
            8.0181e-01,  8.0247e-01]]],


        [[[-3.3683e-01,  1.2386e+00,  1.0211e+00,  ..., -1.0835e+00,
           -3.8156e-01,  1.2067e-01],
          [-5.7500e-01, -4.7789e-02, -4.3910e-01,  ..., -5.0978e-01,
           -1.7201e+00,  7.9874e-01],
          [ 4.3281e-01, -4.5785e-01,  7.3989e-02,  ...,  1.2869e+00,
            8.5913e-01,  8.3880e-01],
          ...,
          [-3.4928e-01,  1.2275e+00, -7.8620e-01,  ...,  5.4931e-01,
            3.4198e+00, -1.1204e+00],
          [ 6.6646e-01,  1.8671e+00, -1.5031e+00,  ...,  1.7013e-01,
           -2.3470e-01,  5.8819e-01],
          [-1.6700e+00, -4.2757e-01,  1.2553e+00,  ..., -1.1003e+00,
           -8.9800e-01, -4.1769e-02]],

         [[-1.6719e-01,  1.6163e+00, -1.1796e+00,  ...,  2.6306e-01,
           -1.4335e+00,  1.3457e+00],
          [-9.7507e-01,  1.0576e+00,  1.8611e+00,  ..., -3.7588e-01,
           -9.2034e-01, -1.6309e-02],
          [ 7.9301e-01, -1.6824e+00, -1.3174e+00,  ..., -5.1081e-01,
            4.7801e-01, -4.8752e-01],
          ...,
          [-5.8976e-02, -1.1348e+00,  3.0135e+00,  ..., -1.0033e+00,
           -1.2645e+00,  4.7651e-01],
          [-2.6892e-01, -5.1073e-01, -9.6034e-01,  ..., -1.0549e+00,
            2.7235e-01, -1.2276e-01],
          [ 4.0550e-01,  2.6741e-01, -1.0337e+00,  ..., -7.9156e-01,
            5.1899e-01, -5.8660e-01]],

         [[-1.0550e-01, -7.4928e-01, -3.3414e-01,  ..., -6.7337e-01,
            6.6397e-01,  7.8032e-01],
          [ 1.0779e+00, -4.8563e-01, -1.9238e+00,  ..., -1.3891e+00,
            8.3047e-01,  1.3651e+00],
          [ 2.7654e+00,  6.0275e-01, -1.6391e+00,  ...,  1.3500e+00,
           -5.6960e-01, -2.7533e-01],
          ...,
          [ 1.2489e+00, -5.3105e-01, -2.0088e+00,  ...,  4.5269e-01,
            2.4169e-01, -3.0317e-01],
          [ 9.0025e-02,  2.4912e+00,  1.0799e+00,  ...,  1.8334e-01,
           -8.0403e-01, -6.4218e-01],
          [ 2.9027e+00, -8.9185e-01,  7.0595e-01,  ..., -8.3855e-01,
           -3.1782e-01,  1.0333e-01]]],


        [[[-8.9184e-02, -1.2855e+00,  1.3610e+00,  ..., -1.4476e+00,
            7.9148e-01,  2.7980e-01],
          [-1.6924e+00,  5.4488e-01,  2.4170e-01,  ...,  1.9963e+00,
           -7.3559e-02,  2.0199e-01],
          [ 1.3872e+00,  5.5393e-01, -5.8951e-01,  ..., -9.1987e-01,
           -1.1465e+00, -9.6177e-02],
          ...,
          [-1.5230e-01,  1.4959e-01,  1.1349e+00,  ..., -5.2274e-01,
           -2.1672e-02,  2.2436e-01],
          [ 4.3020e-01, -2.4287e-01, -1.0371e+00,  ..., -1.9941e+00,
           -2.6805e-02, -1.3049e-01],
          [ 7.3408e-02,  3.3207e-01, -9.6911e-02,  ...,  7.8593e-01,
           -1.4009e+00, -4.3703e-02]],

         [[-2.9170e-03,  1.6952e+00,  1.6401e+00,  ..., -5.2795e-01,
            1.2140e+00, -4.3861e-01],
          [ 3.5033e-01,  4.5625e-01,  2.8558e-01,  ...,  1.8198e-01,
           -1.4276e+00, -3.1478e-01],
          [ 1.3318e+00,  2.7039e-01, -6.7459e-01,  ..., -2.1824e+00,
           -1.8201e+00,  1.6870e+00],
          ...,
          [ 2.9704e-01, -1.4394e+00, -2.1037e-04,  ..., -6.9401e-01,
            3.8101e-01, -1.1351e+00],
          [-2.7331e-01, -9.2555e-01, -8.2653e-01,  ...,  2.6966e-01,
           -1.2000e+00,  5.6627e-01],
          [ 5.5585e-01, -1.4303e+00,  1.8872e-01,  ...,  9.3833e-01,
            6.5064e-01,  7.0446e-01]],

         [[ 2.8637e+00, -1.4305e+00,  1.0679e-02,  ..., -2.0463e+00,
            1.5153e+00,  1.1713e+00],
          [ 1.4977e-01, -1.2533e+00,  4.9531e-01,  ...,  5.9733e-01,
           -8.5407e-01, -1.1227e+00],
          [ 1.0660e+00,  1.1540e+00, -2.2753e-01,  ..., -2.9771e-01,
            1.2117e+00,  6.9136e-01],
          ...,
          [-1.1785e+00, -1.0272e+00,  3.8972e-01,  ..., -3.6896e-01,
           -2.2788e-01, -1.1467e+00],
          [-7.9288e-02, -1.3024e-01, -6.1609e-02,  ...,  2.5734e+00,
           -2.8271e-01,  1.1660e+00],
          [ 3.5542e-01, -1.2648e+00, -8.5502e-01,  ..., -4.8831e-01,
            2.1795e+00,  1.2746e+00]]],


        [[[-1.8552e+00,  1.6146e+00,  1.0220e+00,  ..., -4.2196e-01,
            1.5942e+00, -2.5055e+00],
          [ 1.8447e+00, -7.7232e-01,  5.1373e-02,  ..., -8.1246e-02,
           -2.3343e+00,  3.6027e-01],
          [ 1.4262e+00,  1.2971e+00,  6.7529e-01,  ..., -7.2369e-01,
           -2.7188e+00,  6.6873e-01],
          ...,
          [ 2.9984e+00,  8.6070e-01,  7.3528e-01,  ...,  1.5952e+00,
            9.8498e-01,  9.0171e-02],
          [ 6.4501e-01,  3.8302e-01, -1.7107e+00,  ...,  1.7141e+00,
            8.7024e-01,  3.1629e-01],
          [ 1.7794e+00, -6.4178e-01,  6.7278e-02,  ..., -9.3933e-01,
           -1.0589e+00, -1.3617e+00]],

         [[ 1.8505e-01,  8.9756e-01, -7.2779e-01,  ..., -1.3639e+00,
           -6.4751e-01,  3.3342e-02],
          [ 2.0381e-02,  1.4175e+00,  1.4758e-01,  ..., -2.2673e+00,
           -2.1866e+00,  6.7363e-01],
          [-1.5469e-01, -2.6813e-01,  2.8125e-01,  ..., -8.8246e-01,
            1.8973e+00, -1.6016e-01],
          ...,
          [ 1.2037e+00,  1.1861e+00,  1.0916e+00,  ...,  4.9370e-01,
            1.2188e+00, -2.7642e-01],
          [ 1.5737e+00,  1.3977e+00, -2.3695e+00,  ..., -1.3305e+00,
           -6.4690e-01, -1.2787e-03],
          [ 2.3392e+00, -6.3326e-01,  5.8710e-01,  ..., -1.9145e-01,
            7.8408e-01, -7.1637e-01]],

         [[-1.3163e+00,  1.7858e-01, -1.0556e-02,  ...,  4.0195e-01,
           -4.7367e-02,  2.7552e-01],
          [-1.5814e+00,  2.7517e-01, -1.3067e-01,  ..., -2.8932e-01,
           -8.3646e-01, -1.8450e+00],
          [-1.6091e-01, -1.2749e+00,  2.0794e-01,  ..., -1.1432e+00,
           -1.4129e+00, -1.2525e+00],
          ...,
          [ 3.4557e-01, -1.4384e-01,  5.9435e-01,  ..., -1.0417e-01,
            1.0897e+00,  8.9845e-01],
          [-1.3049e+00, -7.4602e-01,  9.0923e-01,  ...,  8.6445e-01,
           -2.9511e-01, -1.2269e+00],
          [-7.0079e-01, -1.3425e-01,  5.9911e-01,  ..., -1.8419e-01,
           -9.6245e-01, -2.8821e-01]]]])}, &#39;action&#39;: tensor([[0],
        [5],
        [6],
        [0]]), &#39;reward&#39;: tensor([[0.4639],
        [0.5141],
        [0.8573],
        [0.2590]]), &#39;done&#39;: tensor([False, False, False, False])}
</pre></div></td></tr></table></div>
</div>
<p>We can see that the structure process function need to be fully implemented (like the function <code class="docutils literal notranslate"><span class="pre">stack</span></code>). This code is actually not clear, and due to hard coding, if you need to support more data types (such as integer), you must make special modifications to the function.</p>
</section>
<section id="stack-with-treetensor-api">
<h2>Stack With TreeTensor API<a class="headerlink" href="#stack-with-treetensor-api" title="Permalink to this headline">¶</a></h2>
<p>The same workflow can be implemented with treetensor API like the code below.</p>
<div class="highlight-python notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="kn">import</span> <span class="nn">treetensor.torch</span> <span class="k">as</span> <span class="nn">ttorch</span>

<span class="n">B</span> <span class="o">=</span> <span class="mi">4</span>


<span class="k">def</span> <span class="nf">get_item</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;obs&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;scalar&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">12</span><span class="p">),</span>
            <span class="s1">&#39;image&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span>
        <span class="p">},</span>
        <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,)),</span>
        <span class="s1">&#39;reward&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
        <span class="s1">&#39;done&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">}</span>


<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_item</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">B</span><span class="p">)]</span>
<span class="c1"># execute `stack` op</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">ttorch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
<span class="n">stacked_data</span> <span class="o">=</span> <span class="n">ttorch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># validate</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stacked_data</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">stacked_data</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">stacked_data</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">stacked_data</span><span class="o">.</span><span class="n">reward</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">stacked_data</span><span class="o">.</span><span class="n">done</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">B</span><span class="p">,)</span>
<span class="k">assert</span> <span class="n">stacked_data</span><span class="o">.</span><span class="n">done</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">torch</span><span class="o">.</span><span class="n">bool</span>
</pre></div></td></tr></table></div>
</div>
<p>The output should be like below, and the assertion statements can be all passed as well.</p>
<div class="highlight-text notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span></pre></div></td><td class="code"><div><pre><span></span>&lt;Tensor 0x7f9a7987b450&gt;
├── &#39;action&#39; --&gt; tensor([[1],
│                        [0],
│                        [6],
│                        [6]])
├── &#39;done&#39; --&gt; tensor([False, False, False, False])
├── &#39;obs&#39; --&gt; &lt;Tensor 0x7f9ad628c810&gt;
│   ├── &#39;image&#39; --&gt; tensor([[[[ 2.2669,  0.8907,  1.6821,  ..., -1.2985,  0.5086,  1.4555],
│   │                         [ 1.4997, -0.5174, -0.2689,  ...,  0.4063,  0.1767, -0.0260],
│   │                         [ 0.1412,  0.9810, -0.9320,  ...,  1.2321, -0.1103,  0.2297],
│   │                         ...,
│   │                         [ 1.1940, -1.6710, -0.1690,  ..., -1.9100, -1.3847, -0.4023],
│   │                         [-0.7098, -0.3767, -0.0872,  ...,  0.7385,  0.7251,  0.9126],
│   │                         [-0.3410, -1.5066, -0.5058,  ..., -0.7446, -0.2559,  0.3796]],
│   │               
│   │                        [[ 0.3755, -0.4098, -1.0349,  ..., -0.3869, -1.4397,  0.2950],
│   │                         [-1.0464,  0.5062, -0.3514,  ..., -1.0319, -1.4609,  0.4511],
│   │                         [ 0.3076, -2.0404,  1.1883,  ...,  0.6595,  1.6183,  0.4075],
│   │                         ...,
│   │                         [-0.1358, -0.4710, -0.9259,  ...,  0.8660, -0.1984,  0.8133],
│   │                         [ 1.8685, -1.2277,  1.8584,  ...,  1.0047, -0.3181, -2.0297],
│   │                         [ 1.2189,  1.1000,  0.5702,  ..., -0.3910,  1.0541, -1.3260]],
│   │               
│   │                        [[-1.0056,  0.2915, -1.0495,  ..., -1.0677,  0.2117,  0.7565],
│   │                         [ 0.9151,  0.9340,  0.0421,  ...,  1.1526, -0.5646,  0.3422],
│   │                         [ 1.7615,  1.1583, -1.2554,  ..., -0.2676,  0.0316,  0.9946],
│   │                         ...,
│   │                         [ 0.3578, -0.4843, -0.3653,  ...,  1.0925,  0.6245,  1.4284],
│   │                         [ 0.0074, -1.4538, -1.4967,  ..., -0.9595,  2.5783,  0.6781],
│   │                         [ 1.2307,  1.1389, -0.1777,  ...,  0.8436,  0.4925, -0.6570]]],
│   │               
│   │               
│   │                       [[[-1.5133,  1.7842,  0.1932,  ...,  0.1993, -1.1814,  0.5100],
│   │                         [-1.2658, -1.9795, -1.9588,  ..., -1.6118, -0.4457, -0.4403],
│   │                         [-0.3390, -1.4599,  0.1501,  ..., -1.9446, -0.7222, -2.1773],
│   │                         ...,
│   │                         [ 0.9527, -0.2617, -1.3956,  ..., -1.1404, -2.3297,  0.6625],
│   │                         [ 1.0870,  0.2193,  0.4097,  ...,  1.4330,  0.0214,  0.6979],
│   │                         [-0.2513,  1.3748,  1.2897,  ...,  0.3779,  0.9330,  2.2482]],
│   │               
│   │                        [[ 0.2094, -0.5610, -0.7689,  ...,  0.1162, -0.8106,  1.3883],
│   │                         [-1.1698, -0.9337, -0.0109,  ...,  0.8616,  0.1392,  0.3606],
│   │                         [ 0.2463,  0.1158, -0.2136,  ..., -1.4804, -1.1801,  1.3681],
│   │                         ...,
│   │                         [-1.4142, -0.7715, -0.9185,  ...,  0.3545,  0.2171,  0.8557],
│   │                         [-0.0941, -2.1593, -0.8395,  ...,  0.4691,  1.3316, -0.2293],
│   │                         [ 0.6652,  1.1402,  0.2809,  ..., -0.2932, -1.6693, -2.4504]],
│   │               
│   │                        [[ 0.0189, -0.1005, -0.3479,  ...,  1.3787, -0.1728, -0.2545],
│   │                         [ 0.8131,  0.5481,  0.0970,  ...,  0.8218,  0.6432, -0.0157],
│   │                         [-1.1054, -0.4112, -0.0640,  ...,  0.1058,  0.3089, -0.1116],
│   │                         ...,
│   │                         [-1.1738,  0.3323,  0.5522,  ...,  0.6488,  0.0435, -0.0160],
│   │                         [ 0.7896,  1.4188, -0.7927,  ..., -0.7951, -0.3203,  0.7248],
│   │                         [ 0.9948,  0.5743, -0.5119,  ..., -1.5449, -0.9142, -0.1377]]],
│   │               
│   │               
│   │                       [[[ 3.0979, -0.2279, -0.1319,  ...,  0.1082,  0.1696, -0.0694],
│   │                         [ 0.5114,  0.3114, -2.0327,  ..., -0.1176,  0.3580,  1.0767],
│   │                         [-0.1594,  1.8470,  0.3718,  ..., -0.9124,  0.2079, -0.0921],
│   │                         ...,
│   │                         [-0.5353, -0.5612, -0.0363,  ..., -1.3952,  0.5072,  1.3637],
│   │                         [-0.3921, -0.6594, -0.3354,  ...,  0.8403,  1.6900,  1.6134],
│   │                         [ 1.6292,  0.2685, -1.6771,  ...,  0.3548, -1.2445, -0.3479]],
│   │               
│   │                        [[ 1.3315,  1.4303,  0.3067,  ..., -0.3782,  0.0512, -0.2043],
│   │                         [-1.8736, -0.0441, -0.9856,  ...,  1.4202, -0.5448,  0.3291],
│   │                         [-0.6190,  0.0699, -1.6261,  ..., -0.4695,  0.8126,  0.2419],
│   │                         ...,
│   │                         [ 0.9034,  0.1009, -0.0449,  ..., -1.2601, -0.3284, -0.9625],
│   │                         [ 2.1808, -0.3905,  1.0542,  ..., -0.6980,  0.1778,  0.3678],
│   │                         [ 0.0650,  0.2640, -0.0935,  ...,  1.4487,  1.1102,  1.1744]],
│   │               
│   │                        [[-1.8246, -1.6142,  0.8517,  ...,  1.7856,  0.5367, -0.2550],
│   │                         [ 0.7648,  0.8442,  1.0046,  ..., -1.3520,  0.5757,  1.1707],
│   │                         [-0.4575,  0.9782, -1.5556,  ...,  0.1360, -0.5721, -0.3388],
│   │                         ...,
│   │                         [ 1.3466,  0.9026,  1.5220,  ...,  1.3948, -1.7090,  1.6193],
│   │                         [ 1.8838, -0.3384,  0.1850,  ..., -2.1799,  1.0228, -0.0346],
│   │                         [-0.6500,  0.1816,  1.6733,  ...,  0.5686,  0.0879, -0.4000]]],
│   │               
│   │               
│   │                       [[[-0.8893,  1.2414,  0.5240,  ..., -0.7164, -0.5872,  0.9348],
│   │                         [-0.1265,  0.7704,  1.2610,  ...,  0.0654, -0.7305,  0.2034],
│   │                         [ 0.4848, -1.9672, -2.5662,  ...,  0.4317, -1.9296, -1.9077],
│   │                         ...,
│   │                         [-0.1319,  0.2544, -0.4207,  ..., -1.6458,  0.7736, -0.5441],
│   │                         [ 0.7415, -0.1753, -1.4631,  ...,  0.3038,  0.4033,  0.4494],
│   │                         [-0.9282, -0.0569, -0.1261,  ...,  0.2730, -1.4300,  0.0147]],
│   │               
│   │                        [[-1.4821, -0.4707,  0.9586,  ..., -1.7290, -0.2627, -0.0524],
│   │                         [ 1.5292, -1.0936, -0.3891,  ..., -1.3467, -0.9191, -0.9130],
│   │                         [-0.3060,  0.0537, -0.0597,  ...,  0.6320,  1.6346,  0.1232],
│   │                         ...,
│   │                         [ 0.3678, -0.7664,  0.2035,  ..., -0.5942, -0.0791, -1.4654],
│   │                         [-1.9735, -0.0138,  0.4998,  ..., -2.7653,  1.2657,  0.9546],
│   │                         [-0.4760,  1.8567,  0.6417,  ..., -0.1950, -1.1243,  1.0453]],
│   │               
│   │                        [[-0.0497,  1.3509, -0.0581,  ...,  1.0395,  0.0889, -0.3462],
│   │                         [-1.6594, -1.1444,  0.5851,  ...,  1.3883, -0.5580, -1.0085],
│   │                         [ 0.9260, -0.4823,  0.6134,  ..., -1.0218,  2.2049,  0.2800],
│   │                         ...,
│   │                         [ 1.6157, -1.1509,  0.1818,  ...,  0.6613, -0.2158,  0.9293],
│   │                         [ 0.3901, -2.2389,  0.0684,  ...,  0.1481, -2.0695, -0.3106],
│   │                         [-0.2117, -0.0385, -0.4805,  ..., -0.3600, -1.1076, -0.3162]]]])
│   └── &#39;scalar&#39; --&gt; tensor([[ 1.0198, -1.7624,  1.0252,  1.7087,  0.1913, -0.9768,  0.4277, -1.1888,
│                             -1.0746, -1.8198, -0.8662, -1.2279],
│                            [-0.4676, -0.2972, -0.4893, -0.0051,  1.9497, -0.1833, -0.7041, -0.7854,
│                              1.5661,  0.4378, -0.4511,  0.0450],
│                            [ 1.6819,  1.0681, -1.3918,  2.2446, -0.3502, -0.9089,  0.0544, -0.0842,
│                              1.5768,  0.1648, -0.4564,  1.3333],
│                            [ 0.5697,  1.1296, -0.0919, -2.0735, -1.0806,  1.3402, -1.0857,  1.0934,
│                              0.1318,  1.0935,  0.5003,  0.1701]])
└── &#39;reward&#39; --&gt; tensor([[0.2749],
                         [0.9598],
                         [0.0603],
                         [0.8792]])
</pre></div></td></tr></table></div>
</div>
<p>This code looks much simpler and clearer.</p>
</section>
</section>



           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../operation/index.html" class="btn btn-neutral float-right" title="Customized Operations For Different Fields" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../../tutorials/plugins/index.html" class="btn btn-neutral float-left" title="Plugins" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2023, HansBug, DI-engine&#39;s Contributors

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
    <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: main
    <span class="fa fa-caret-down"></span>
  </span>
        <div class="rst-other-versions">
                <dl>
                    <dt>Tags</dt>
                        <dd><a href="../../../v0.2.1/best_practice/stack/index.html">v0.2.1</a></dd>
                        <dd><a href="../../../v0.3.0/best_practice/stack/index.html">v0.3.0</a></dd>
                        <dd><a href="../../../v0.4.0/best_practice/stack/index.html">v0.4.0</a></dd>
                </dl>
                <dl>
                    <dt>Branches</dt>
                        <dd><a href="../../../16/merge/best_practice/stack/index.html">16/merge</a></dd>
                        <dd><a href="../../../dev/constraint/best_practice/stack/index.html">dev/constraint</a></dd>
                        <dd><a href="index.html">main</a></dd>
                        <dd><a href="../../../run/xdemos/best_practice/stack/index.html">run/xdemos</a></dd>
                </dl>
        </div>
    </div>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>