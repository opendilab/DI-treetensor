

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Stack Structured Data &mdash; DI-treetensor 0.4.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Customized Operations For Different Fields" href="../operation/index.html" />
    <link rel="prev" title="Plugins" href="../../tutorials/plugins/index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> DI-treetensor
          

          
          </a>

          
            
            
              <div class="version">
                0.4.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/installation/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/quick_start/index.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/plugins/index.html">Plugins</a></li>
</ul>
<p><span class="caption-text">Best Practice</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Stack Structured Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#stack-with-native-pytorch-api">Stack With Native PyTorch API</a></li>
<li class="toctree-l2"><a class="reference internal" href="#stack-with-treetensor-api">Stack With TreeTensor API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../operation/index.html">Customized Operations For Different Fields</a></li>
</ul>
<p><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api_doc/common/index.html">treetensor.common</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_doc/config/index.html">treetensor.config</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_doc/numpy/index.html">treetensor.numpy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_doc/torch/index.html">treetensor.torch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_doc/utils/index.html">treetensor.utils</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">DI-treetensor</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Stack Structured Data</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/best_practice/stack/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
    
    
  <section id="stack-structured-data">
<h1>Stack Structured Data<a class="headerlink" href="#stack-structured-data" title="Permalink to this headline">¶</a></h1>
<p>When the tensors form the tree structures, they are often needed to be stacked together, like the <a class="reference internal" href="../../api_doc/torch/funcs.stack.auto.html#torch.stack" title="torch.stack"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.stack()</span></code></a> implemented in torch.</p>
<section id="stack-with-native-pytorch-api">
<h2>Stack With Native PyTorch API<a class="headerlink" href="#stack-with-native-pytorch-api" title="Permalink to this headline">¶</a></h2>
<p>Here is the common code implement with native pytorch API.</p>
<div class="highlight-python notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span></pre></div></td><td class="code"><div><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="n">B</span> <span class="o">=</span> <span class="mi">4</span>


<span class="k">def</span> <span class="nf">get_item</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;obs&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;scalar&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">12</span><span class="p">),</span>
            <span class="s1">&#39;image&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span>
        <span class="p">},</span>
        <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,)),</span>
        <span class="s1">&#39;reward&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
        <span class="s1">&#39;done&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">}</span>


<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_item</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">B</span><span class="p">)]</span>


<span class="c1"># execute `stack` op</span>
<span class="k">def</span> <span class="nf">stack</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dim</span><span class="p">):</span>
    <span class="n">elem</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">stack</span><span class="p">([</span><span class="n">item</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">],</span> <span class="n">dim</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">elem</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">BoolTensor</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;not support elem type: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">elem</span><span class="p">)))</span>


<span class="n">stacked_data</span> <span class="o">=</span> <span class="n">stack</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># validate</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stacked_data</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">stacked_data</span><span class="p">[</span><span class="s1">&#39;obs&#39;</span><span class="p">][</span><span class="s1">&#39;image&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">stacked_data</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">stacked_data</span><span class="p">[</span><span class="s1">&#39;reward&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">stacked_data</span><span class="p">[</span><span class="s1">&#39;done&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">B</span><span class="p">,)</span>
<span class="k">assert</span> <span class="n">stacked_data</span><span class="p">[</span><span class="s1">&#39;done&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">torch</span><span class="o">.</span><span class="n">bool</span>
</pre></div></td></tr></table></div>
</div>
<p>The output should be like below, and the assertion statements can be all passed.</p>
<div class="highlight-text notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span></pre></div></td><td class="code"><div><pre><span></span>{&#39;obs&#39;: {&#39;scalar&#39;: tensor([[ 1.4052e+00, -1.7773e+00, -5.8387e-01,  6.6034e-01, -1.7363e+00,
         -3.8672e-01, -8.5461e-01, -2.0515e-01,  2.9595e-01, -1.2947e-01,
         -5.5784e-02,  1.0080e-01],
        [ 1.0508e+00, -7.8752e-01, -2.4226e+00, -1.1606e+00,  3.8491e-01,
         -4.9895e-01, -2.6877e+00,  4.7121e-01,  2.2173e+00, -8.6053e-01,
         -1.3468e+00,  1.2641e+00],
        [ 5.2611e-02, -5.7890e-01, -8.9040e-01,  1.5478e+00,  2.8286e+00,
         -1.0418e+00,  4.2803e-01, -2.1519e-03, -1.8103e+00, -6.3784e-02,
          9.0412e-01,  5.7581e-01],
        [-4.1343e-01,  1.5818e+00, -4.1012e-02, -1.5352e-01,  4.5773e-01,
          5.4010e-01, -3.0702e-01, -1.3935e+00,  7.5567e-01,  1.0546e+00,
          6.8059e-02, -6.8938e-01]]), &#39;image&#39;: tensor([[[[ 1.7420,  0.6527,  0.1175,  ...,  0.1457,  0.1649, -0.4652],
          [ 1.4183,  1.5208, -1.3020,  ..., -0.3915, -0.4505,  0.9859],
          [-0.7113,  2.1656,  0.7291,  ..., -0.1819,  0.5799,  0.9185],
          ...,
          [-1.1225,  1.1831,  0.3677,  ...,  0.1429, -0.3502,  1.5383],
          [-0.5372, -0.4279,  0.6517,  ...,  0.7502, -0.1965, -0.4545],
          [ 0.1320,  0.5321,  0.3715,  ...,  2.0031,  0.5095,  0.1267]],

         [[ 0.3518,  0.8030, -0.0064,  ...,  1.3216, -0.9377, -0.1762],
          [-1.0049,  2.4111,  2.5910,  ..., -0.1782, -1.4690,  0.1893],
          [ 1.1539, -1.4107,  0.5889,  ...,  1.5942, -0.3850,  0.7438],
          ...,
          [ 0.9807, -2.1229, -0.6356,  ...,  1.3453, -0.5440,  1.1274],
          [ 1.4152, -1.0828,  0.2116,  ..., -1.2809,  0.4518, -2.5963],
          [ 0.3060,  1.6317,  0.4263,  ...,  0.5185, -1.1209, -0.8848]],

         [[ 0.6448,  1.0809,  0.1009,  ..., -0.1178,  1.7161,  0.5929],
          [-0.9480,  0.7136, -0.5320,  ..., -0.8696,  0.5382,  0.9502],
          [-0.1916,  1.7798,  1.5847,  ...,  1.9473,  0.3765, -0.1970],
          ...,
          [ 1.8572, -2.2852, -0.4197,  ..., -0.0063,  1.0930,  0.3529],
          [ 0.5180,  0.5384, -0.6236,  ..., -0.8107,  1.2101,  1.5390],
          [-0.3266, -0.2176, -0.5414,  ...,  0.7054,  1.8928,  0.1166]]],


        [[[ 0.4033,  1.4413,  0.1223,  ...,  0.9998, -1.2564,  0.5795],
          [ 0.3453,  0.2417,  1.0466,  ..., -0.9168, -0.9127,  1.0472],
          [-0.7336, -0.2673, -1.0352,  ..., -0.4923, -0.8334,  0.6507],
          ...,
          [-0.0799,  1.1033, -0.5683,  ..., -0.6048,  0.0786, -2.1886],
          [-0.0905, -1.2177,  1.0267,  ...,  0.0657, -1.0370,  0.1090],
          [-0.7798,  0.2612,  0.2742,  ..., -0.1255, -2.8487,  1.6547]],

         [[-0.9419,  0.2179, -0.9820,  ...,  0.0564, -0.2283,  0.0089],
          [ 1.0026,  0.4794, -1.3860,  ...,  0.5057, -0.4858,  2.0904],
          [ 1.8416, -0.8231,  1.7601,  ...,  0.3571,  1.1902, -0.9704],
          ...,
          [-0.4617,  0.8035, -0.4196,  ..., -0.4593,  0.5374,  0.1618],
          [-0.5171,  0.4882, -1.9815,  ...,  0.6424,  0.3053, -0.4590],
          [ 0.1000,  3.1519,  1.9026,  ...,  0.3229, -1.4429,  0.8851]],

         [[ 0.2085,  1.3735,  1.0960,  ..., -0.1203, -0.5254,  1.0778],
          [ 1.4255,  1.5801,  0.9836,  ...,  0.0663, -0.4169,  0.1113],
          [ 0.2421, -1.1847, -0.4172,  ..., -1.6670,  0.5319,  0.4759],
          ...,
          [-0.3607, -0.4857,  0.3465,  ..., -1.2480, -0.7657,  0.0091],
          [-1.5946, -0.8584, -1.0131,  ..., -0.6327,  1.1448,  2.4825],
          [ 0.5073,  0.2452,  0.4701,  ...,  0.0391,  0.7025, -0.3462]]],


        [[[-0.1077, -0.3857, -0.2883,  ..., -0.4757, -0.2287, -0.8150],
          [-0.6035,  0.5797, -1.1909,  ...,  0.2971, -1.3121,  0.7343],
          [ 0.9504, -1.0850,  0.2829,  ...,  1.5528, -0.6702, -1.4253],
          ...,
          [ 0.3421, -0.3041,  0.3914,  ..., -0.0516, -0.4031,  0.8485],
          [ 0.1451, -2.4392, -1.2813,  ...,  0.5403, -0.3717, -1.3327],
          [ 0.3560,  1.9361,  0.2432,  ..., -0.0441,  0.4184, -0.1016]],

         [[-1.8608,  1.4555, -0.7329,  ..., -2.2516,  0.2519,  0.8369],
          [-0.9468, -0.2091, -0.6344,  ...,  0.2748,  1.8337,  0.4499],
          [-1.1368, -0.2651,  0.4035,  ..., -1.2474, -0.0050,  2.6998],
          ...,
          [ 0.1794,  2.6861, -1.0386,  ...,  0.8269, -1.2014,  0.0441],
          [ 0.7712, -0.8942,  0.7470,  ...,  0.5827,  0.0612,  0.9457],
          [-0.9857,  0.1258, -0.1759,  ...,  0.4200, -0.1094,  0.5993]],

         [[-1.0059,  0.8278, -0.0270,  ..., -0.1945,  0.0074,  2.2872],
          [ 0.8708,  0.5865, -0.1535,  ...,  0.9401, -0.5448,  0.2569],
          [-0.4326, -0.0624, -0.3691,  ...,  0.5223, -0.5207, -0.7034],
          ...,
          [-0.1182, -0.8976, -0.1424,  ...,  0.1485,  0.7435, -1.0765],
          [ 1.2793,  1.2948,  1.0224,  ...,  0.7019, -1.6751, -0.0476],
          [-0.2299, -0.0308, -0.3465,  ...,  1.6228, -0.3588, -0.5035]]],


        [[[-0.0172,  1.0928, -1.6237,  ..., -1.2195,  0.4166,  0.2659],
          [-0.3310,  0.6719,  1.5472,  ...,  0.3727,  0.5449, -1.0249],
          [-0.4078,  0.6899, -0.4999,  ...,  0.6870, -1.2364,  0.1150],
          ...,
          [ 1.4495,  0.5932, -1.3336,  ..., -0.7043,  1.0027,  0.7191],
          [-0.8062, -1.2019,  1.1801,  ..., -1.8398, -0.3978, -0.7037],
          [ 1.0640, -0.2624, -0.8784,  ..., -0.5864,  4.0092,  0.2025]],

         [[ 0.9063, -1.0353, -1.3626,  ...,  1.5984, -1.5478, -0.4236],
          [ 0.2843, -0.1100,  0.0393,  ..., -0.7149, -1.5662,  0.5891],
          [ 1.1815,  0.4593, -0.1958,  ..., -0.9103, -1.1771, -0.0329],
          ...,
          [-0.8543, -2.2893,  0.3082,  ...,  0.6328,  0.3811,  0.7120],
          [ 2.1889, -1.3921,  1.1095,  ...,  0.1376, -0.8980, -0.3329],
          [-1.0774, -0.8113,  0.5486,  ...,  1.8146, -1.4056,  1.8168]],

         [[ 0.0764,  0.6058, -0.8262,  ..., -0.5816,  0.2587,  1.0790],
          [-2.4942, -0.1461,  0.1206,  ...,  0.4321,  0.8211, -0.1341],
          [-0.5942, -0.1176, -2.0651,  ...,  0.7499,  0.0840,  0.0463],
          ...,
          [-0.3056,  0.4697, -0.0108,  ..., -0.2721, -0.9714,  1.3484],
          [ 0.7121, -0.9550,  2.1020,  ..., -0.4426, -0.5611, -2.7833],
          [ 1.4334,  0.5391,  0.4536,  ...,  0.3466,  1.1698, -1.0543]]]])}, &#39;action&#39;: tensor([[2],
        [7],
        [1],
        [9]]), &#39;reward&#39;: tensor([[0.8572],
        [0.9614],
        [0.9873],
        [0.0411]]), &#39;done&#39;: tensor([False, False, False, False])}
</pre></div></td></tr></table></div>
</div>
<p>We can see that the structure process function need to be fully implemented (like the function <code class="docutils literal notranslate"><span class="pre">stack</span></code>). This code is actually not clear, and due to hard coding, if you need to support more data types (such as integer), you must make special modifications to the function.</p>
</section>
<section id="stack-with-treetensor-api">
<h2>Stack With TreeTensor API<a class="headerlink" href="#stack-with-treetensor-api" title="Permalink to this headline">¶</a></h2>
<p>The same workflow can be implemented with treetensor API like the code below.</p>
<div class="highlight-python notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="kn">import</span> <span class="nn">treetensor.torch</span> <span class="k">as</span> <span class="nn">ttorch</span>

<span class="n">B</span> <span class="o">=</span> <span class="mi">4</span>


<span class="k">def</span> <span class="nf">get_item</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;obs&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;scalar&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">12</span><span class="p">),</span>
            <span class="s1">&#39;image&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span>
        <span class="p">},</span>
        <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,)),</span>
        <span class="s1">&#39;reward&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
        <span class="s1">&#39;done&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">}</span>


<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_item</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">B</span><span class="p">)]</span>
<span class="c1"># execute `stack` op</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">ttorch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
<span class="n">stacked_data</span> <span class="o">=</span> <span class="n">ttorch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># validate</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stacked_data</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">stacked_data</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">stacked_data</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">stacked_data</span><span class="o">.</span><span class="n">reward</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">stacked_data</span><span class="o">.</span><span class="n">done</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">B</span><span class="p">,)</span>
<span class="k">assert</span> <span class="n">stacked_data</span><span class="o">.</span><span class="n">done</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">torch</span><span class="o">.</span><span class="n">bool</span>
</pre></div></td></tr></table></div>
</div>
<p>The output should be like below, and the assertion statements can be all passed as well.</p>
<div class="highlight-text notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span></pre></div></td><td class="code"><div><pre><span></span>&lt;Tensor 0x7f1ba2736110&gt;
├── &#39;action&#39; --&gt; tensor([[3],
│                        [8],
│                        [2],
│                        [6]])
├── &#39;done&#39; --&gt; tensor([False, False, False, False])
├── &#39;obs&#39; --&gt; &lt;Tensor 0x7f1ba272ced0&gt;
│   ├── &#39;image&#39; --&gt; tensor([[[[-8.0272e-01, -2.3841e+00,  7.9006e-01,  ..., -2.5645e-01,
│   │                           9.1558e-01, -1.6385e+00],
│   │                         [ 5.3100e-01, -9.4425e-01,  1.7492e+00,  ..., -1.9137e+00,
│   │                          -1.6268e+00,  1.7856e+00],
│   │                         [ 4.9095e-01,  8.9739e-01,  1.8224e+00,  ...,  5.3972e-01,
│   │                          -3.8173e-01,  5.4391e-01],
│   │                         ...,
│   │                         [-6.6961e-01,  8.6650e-01,  3.0291e-01,  ..., -1.9575e+00,
│   │                           4.5281e-01,  5.8521e-01],
│   │                         [-7.1411e-02, -1.4737e-01,  3.3889e-01,  ...,  1.1326e+00,
│   │                           3.6392e-01,  2.0423e-01],
│   │                         [ 1.5819e+00,  5.1222e-01,  1.2767e+00,  ..., -2.2764e-01,
│   │                          -5.8426e-01,  1.8256e-01]],
│   │               
│   │                        [[-8.9338e-01, -5.4453e-01, -1.1601e-01,  ...,  1.2453e+00,
│   │                          -1.0848e+00, -1.1412e+00],
│   │                         [-6.8860e-01,  1.2240e+00, -1.1484e+00,  ..., -3.0795e-01,
│   │                           5.6119e-01, -8.0798e-01],
│   │                         [ 3.2730e-01,  1.1073e+00,  1.0972e+00,  ..., -1.2830e+00,
│   │                           3.8263e-01,  9.4004e-01],
│   │                         ...,
│   │                         [-1.6588e-02, -8.6700e-01,  8.1934e-01,  ...,  9.7858e-01,
│   │                          -1.0637e+00, -8.9074e-01],
│   │                         [ 3.3737e-01,  1.5986e+00,  4.1928e-01,  ...,  6.0617e-01,
│   │                          -9.3927e-02,  1.0195e+00],
│   │                         [-1.0913e-01,  2.4143e+00,  1.7770e+00,  ...,  1.1862e+00,
│   │                          -2.7267e-02, -1.0324e+00]],
│   │               
│   │                        [[ 4.3171e-01, -3.6501e-01,  8.5578e-01,  ..., -4.9879e-01,
│   │                          -3.5695e-01, -1.5206e-01],
│   │                         [-1.8412e+00,  2.1389e+00, -2.1844e+00,  ...,  4.5520e-01,
│   │                          -2.0417e-01, -1.1076e+00],
│   │                         [ 4.2181e-01, -4.0754e-01,  1.6134e+00,  ...,  1.2659e-01,
│   │                          -4.4250e-01,  2.5770e+00],
│   │                         ...,
│   │                         [-3.3738e-01, -2.1086e-01, -1.0353e+00,  ...,  3.1530e+00,
│   │                          -3.0540e-01, -1.6601e+00],
│   │                         [ 2.0483e+00, -9.6425e-01,  1.1927e+00,  ..., -1.4535e+00,
│   │                           5.3116e-01, -1.4212e+00],
│   │                         [-2.3153e+00,  1.4311e+00, -1.4712e+00,  ..., -4.8334e-01,
│   │                           3.8923e-01,  1.9270e+00]]],
│   │               
│   │               
│   │                       [[[-6.2945e-01, -1.8650e+00,  8.8194e-01,  ..., -8.1628e-01,
│   │                           1.4861e-01, -3.3315e-01],
│   │                         [ 1.7021e-01, -4.9849e-01,  1.8800e-01,  ...,  3.4322e-01,
│   │                           5.2568e-01,  2.9024e-01],
│   │                         [-9.6574e-01,  8.5538e-01,  6.2823e-01,  ...,  3.9464e-01,
│   │                          -1.0429e+00,  1.4594e-01],
│   │                         ...,
│   │                         [ 4.6483e-03,  2.6205e-01, -4.1411e-01,  ..., -7.0661e-01,
│   │                          -2.1496e+00,  4.8173e-03],
│   │                         [-4.4968e-01, -1.5000e+00, -7.7251e-01,  ..., -1.5158e+00,
│   │                          -2.6652e-01,  2.7565e-01],
│   │                         [ 4.3497e-01,  1.4855e-01,  1.1377e-01,  ..., -5.0801e-01,
│   │                           6.0498e-01, -1.6253e+00]],
│   │               
│   │                        [[-3.2084e-01,  1.4767e+00, -7.4011e-01,  ..., -1.1130e+00,
│   │                           6.4477e-02, -6.2410e-01],
│   │                         [-5.7197e-01, -3.1757e-01,  7.0653e-01,  ...,  6.8718e-01,
│   │                          -7.5260e-01, -1.1672e-01],
│   │                         [-8.8768e-02,  4.1500e-03, -2.5560e-01,  ...,  1.4709e+00,
│   │                          -1.4264e-01, -1.5907e-01],
│   │                         ...,
│   │                         [ 3.8557e-01,  5.6732e-01, -8.3638e-01,  ...,  1.2545e+00,
│   │                          -1.7442e-01, -1.1360e+00],
│   │                         [-4.2720e-01,  1.0407e+00,  3.8161e-01,  ...,  1.5672e+00,
│   │                           1.6551e-01,  4.9488e-01],
│   │                         [ 4.8530e-01,  2.9899e-01, -1.4717e+00,  ...,  3.7673e-01,
│   │                          -1.2075e+00,  4.8135e-01]],
│   │               
│   │                        [[ 9.8826e-01,  5.6766e-01,  1.5785e-01,  ..., -1.3667e+00,
│   │                          -4.4706e-01, -6.9187e-01],
│   │                         [ 1.6498e+00, -1.8782e+00,  3.8042e-01,  ..., -1.3604e-01,
│   │                           1.3269e+00, -8.2909e-01],
│   │                         [-3.3650e-01,  2.4440e-01,  2.0447e-01,  ..., -3.4006e-01,
│   │                           1.2402e+00,  1.4668e-01],
│   │                         ...,
│   │                         [-1.7484e+00,  4.4032e-01, -2.4549e+00,  ...,  3.1438e-01,
│   │                          -2.3958e-01, -1.5952e+00],
│   │                         [ 5.1262e-01, -2.7765e-01,  1.7047e+00,  ..., -6.0970e-01,
│   │                          -4.2185e-01, -4.1472e-01],
│   │                         [-1.5770e+00, -1.8925e+00, -7.0924e-01,  ..., -9.0147e-01,
│   │                           5.2331e-01,  1.0363e+00]]],
│   │               
│   │               
│   │                       [[[-8.9536e-01, -4.9164e-01, -3.9795e-01,  ...,  3.6620e-01,
│   │                           3.0001e-01, -6.8945e-01],
│   │                         [ 1.1159e+00, -1.2301e-01, -4.0856e-01,  ..., -2.1513e-01,
│   │                          -2.5895e-01,  7.0871e-01],
│   │                         [-2.2099e-02, -4.6102e-01,  7.7825e-01,  ..., -2.1358e+00,
│   │                           1.0461e+00,  1.0667e+00],
│   │                         ...,
│   │                         [-5.5199e-01, -5.5922e-01,  1.2169e-01,  ..., -7.1916e-01,
│   │                          -1.8963e-01,  5.1970e-01],
│   │                         [-8.5790e-01,  1.0195e+00, -5.7053e-01,  ..., -7.3717e-01,
│   │                           7.6878e-01,  7.1282e-02],
│   │                         [ 3.6162e-01, -1.6008e+00,  8.4391e-01,  ...,  4.6753e-02,
│   │                           1.1070e+00,  2.1099e+00]],
│   │               
│   │                        [[ 1.1773e+00,  6.6790e-01, -1.4699e+00,  ...,  5.5575e-01,
│   │                           2.1243e+00,  9.5396e-01],
│   │                         [ 2.3445e+00, -2.0934e-01,  2.9758e-01,  ..., -7.4588e-01,
│   │                          -2.7523e-01,  1.5363e+00],
│   │                         [ 9.5292e-01, -1.2562e-02,  8.8480e-01,  ...,  1.1603e+00,
│   │                           8.1361e-01,  1.3393e+00],
│   │                         ...,
│   │                         [ 2.6502e+00,  4.3794e-01,  5.3836e-01,  ..., -1.0698e-01,
│   │                           9.9963e-01, -5.8808e-01],
│   │                         [-1.1636e-01, -4.9766e-01, -5.5701e-01,  ...,  2.2188e-01,
│   │                           1.3390e+00, -8.6399e-01],
│   │                         [ 3.7065e-01, -3.3293e-01,  2.0610e-01,  ...,  2.7309e-03,
│   │                          -1.1438e-01,  1.4725e+00]],
│   │               
│   │                        [[-3.0083e-01,  1.0944e+00, -2.1561e-01,  ...,  6.8988e-01,
│   │                          -5.0834e-01,  9.2422e-01],
│   │                         [-1.0191e+00, -1.3112e+00,  5.3423e-01,  ...,  1.2672e+00,
│   │                           9.8404e-01,  2.5765e-02],
│   │                         [ 4.9685e-01, -1.6974e-01,  1.7651e-01,  ...,  5.1799e-01,
│   │                          -1.0199e+00,  2.5070e-01],
│   │                         ...,
│   │                         [ 9.9603e-01, -4.0451e-01,  1.6673e+00,  ...,  3.4136e-01,
│   │                          -1.7904e+00,  1.2355e+00],
│   │                         [ 1.5240e-01, -2.9749e-01, -1.5421e-01,  ...,  1.6355e+00,
│   │                          -1.1738e+00,  4.7648e-01],
│   │                         [-2.7955e-01, -1.1133e+00, -1.4567e+00,  ...,  3.4127e-01,
│   │                          -6.4762e-01,  5.9205e-01]]],
│   │               
│   │               
│   │                       [[[-6.2623e-01,  2.3358e-01,  2.0293e+00,  ..., -4.3418e-01,
│   │                           9.7095e-01, -6.2015e-01],
│   │                         [-1.0748e+00, -3.3297e+00,  1.3498e+00,  ...,  6.8959e-01,
│   │                          -3.5809e-01,  7.3683e-01],
│   │                         [-5.0875e-01,  4.3225e-01,  4.6415e-01,  ...,  7.8499e-01,
│   │                          -1.6973e+00, -1.2073e+00],
│   │                         ...,
│   │                         [-7.1837e-02, -9.9203e-02, -1.9421e-01,  ..., -1.0009e+00,
│   │                          -9.1853e-01, -5.0450e-01],
│   │                         [-4.9889e-01,  7.5252e-01,  6.7231e-02,  ..., -1.3681e+00,
│   │                          -9.1052e-01, -1.1207e+00],
│   │                         [ 1.2154e-03, -1.3922e+00, -3.4801e-01,  ...,  5.7346e-02,
│   │                          -3.7406e-01,  1.9190e-01]],
│   │               
│   │                        [[-9.7755e-01,  1.8231e-01,  3.2512e-01,  ..., -1.3576e-01,
│   │                           1.0786e+00,  3.1993e+00],
│   │                         [ 4.0317e-01, -6.3680e-01,  6.6653e-02,  ..., -6.3647e-01,
│   │                          -2.3665e-01,  2.0578e+00],
│   │                         [ 3.7802e-02,  1.3432e-01,  2.5636e-01,  ..., -4.7357e-01,
│   │                          -1.6048e-01, -1.0445e+00],
│   │                         ...,
│   │                         [ 5.0946e-01,  3.9603e-01, -1.8410e+00,  ..., -8.8317e-01,
│   │                          -1.5635e+00,  7.9576e-01],
│   │                         [ 1.0695e+00, -4.0222e-01,  3.4048e-01,  ..., -8.8829e-01,
│   │                           1.0875e+00, -7.1880e-01],
│   │                         [-4.5796e-01, -1.2467e+00,  4.2538e-01,  ...,  1.3213e+00,
│   │                          -4.3119e-01,  1.0644e+00]],
│   │               
│   │                        [[ 9.0305e-01, -1.2973e+00,  5.5147e-01,  ...,  6.9480e-02,
│   │                           8.7439e-01, -3.7883e-01],
│   │                         [-7.3699e-01,  5.0654e-01, -6.2721e-01,  ...,  2.8533e-01,
│   │                           1.2720e+00, -7.1551e-02],
│   │                         [-1.4088e+00,  1.1598e+00, -7.2348e-01,  ..., -9.0231e-01,
│   │                          -1.6222e-01,  3.5183e-01],
│   │                         ...,
│   │                         [ 8.7213e-01, -9.1273e-01,  7.1712e-01,  ...,  3.5729e-01,
│   │                           4.7479e-01, -1.5547e+00],
│   │                         [ 1.3502e+00, -1.2044e+00, -5.2509e-01,  ..., -5.9351e-01,
│   │                           2.1664e+00, -3.8739e-01],
│   │                         [-1.4721e+00, -1.6715e+00,  1.2622e+00,  ...,  8.5960e-01,
│   │                          -5.2764e-01, -1.5032e-01]]]])
│   └── &#39;scalar&#39; --&gt; tensor([[ 0.4339, -0.2886, -0.9470,  0.1032, -0.4256,  0.4215, -0.0713, -0.0849,
│                             -0.6949,  0.3179, -1.3713,  0.9452],
│                            [ 1.4790,  1.5650,  0.0245, -0.5375, -0.5475,  0.1797,  1.7669,  0.3599,
│                             -0.4402, -0.1360,  0.2335, -1.5170],
│                            [-0.4629,  0.3044,  0.0220,  0.6974,  0.9724,  1.1866, -0.2440,  0.9659,
│                              0.0257,  0.6518,  0.1967, -0.7797],
│                            [ 0.1640,  1.1476,  1.6427,  0.1086,  0.9756,  0.1930, -0.0844,  0.5455,
│                             -0.2247, -0.3768,  0.9834,  0.5088]])
└── &#39;reward&#39; --&gt; tensor([[0.2817],
                         [0.0054],
                         [0.4041],
                         [0.1215]])
</pre></div></td></tr></table></div>
</div>
<p>This code looks much simpler and clearer.</p>
</section>
</section>



           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../operation/index.html" class="btn btn-neutral float-right" title="Customized Operations For Different Fields" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../../tutorials/plugins/index.html" class="btn btn-neutral float-left" title="Plugins" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2023, HansBug, DI-engine&#39;s Contributors

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
    <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: main
    <span class="fa fa-caret-down"></span>
  </span>
        <div class="rst-other-versions">
                <dl>
                    <dt>Tags</dt>
                        <dd><a href="../../../v0.2.1/best_practice/stack/index.html">v0.2.1</a></dd>
                        <dd><a href="../../../v0.3.0/best_practice/stack/index.html">v0.3.0</a></dd>
                        <dd><a href="../../../v0.4.0/best_practice/stack/index.html">v0.4.0</a></dd>
                </dl>
                <dl>
                    <dt>Branches</dt>
                        <dd><a href="index.html">main</a></dd>
                        <dd><a href="../../../dev/constraint/best_practice/stack/index.html">dev/constraint</a></dd>
                        <dd><a href="../../../dev/torch/best_practice/stack/index.html">dev/torch</a></dd>
                        <dd><a href="../../../run/xdemos/best_practice/stack/index.html">run/xdemos</a></dd>
                </dl>
        </div>
    </div>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>