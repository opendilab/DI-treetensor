

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Stack Structured Data &mdash; DI-treetensor 0.2.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Customized Operations For Different Fields" href="../operation/index.html" />
    <link rel="prev" title="Plugins" href="../../tutorials/plugins/index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> DI-treetensor
          

          
          </a>

          
            
            
              <div class="version">
                0.2.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/installation/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/quick_start/index.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/plugins/index.html">Plugins</a></li>
</ul>
<p><span class="caption-text">Best Practice</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Stack Structured Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#stack-with-native-pytorch-api">Stack With Native PyTorch API</a></li>
<li class="toctree-l2"><a class="reference internal" href="#stack-with-treetensor-api">Stack With TreeTensor API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../operation/index.html">Customized Operations For Different Fields</a></li>
</ul>
<p><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api_doc/common/index.html">treetensor.common</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_doc/config/index.html">treetensor.config</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_doc/numpy/index.html">treetensor.numpy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_doc/torch/index.html">treetensor.torch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_doc/utils/index.html">treetensor.utils</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">DI-treetensor</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Stack Structured Data</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/best_practice/stack/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
    
    
  <section id="stack-structured-data">
<h1>Stack Structured Data<a class="headerlink" href="#stack-structured-data" title="Permalink to this headline">¶</a></h1>
<p>When the tensors form the tree structures, they are often needed to be stacked together, like the <a class="reference internal" href="../../api_doc/torch/funcs.stack.auto.html#torch.stack" title="torch.stack"><code class="xref py py-func docutils literal notranslate"><span class="pre">torch.stack()</span></code></a> implemented in torch.</p>
<section id="stack-with-native-pytorch-api">
<h2>Stack With Native PyTorch API<a class="headerlink" href="#stack-with-native-pytorch-api" title="Permalink to this headline">¶</a></h2>
<p>Here is the common code implement with native pytorch API.</p>
<div class="highlight-python notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span></pre></div></td><td class="code"><div><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="n">B</span> <span class="o">=</span> <span class="mi">4</span>


<span class="k">def</span> <span class="nf">get_item</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;obs&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;scalar&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">12</span><span class="p">),</span>
            <span class="s1">&#39;image&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span>
        <span class="p">},</span>
        <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,)),</span>
        <span class="s1">&#39;reward&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
        <span class="s1">&#39;done&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">}</span>


<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_item</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">B</span><span class="p">)]</span>


<span class="c1"># execute `stack` op</span>
<span class="k">def</span> <span class="nf">stack</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dim</span><span class="p">):</span>
    <span class="n">elem</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">stack</span><span class="p">([</span><span class="n">item</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">],</span> <span class="n">dim</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">elem</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">BoolTensor</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;not support elem type: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">elem</span><span class="p">)))</span>


<span class="n">stacked_data</span> <span class="o">=</span> <span class="n">stack</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># validate</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stacked_data</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">stacked_data</span><span class="p">[</span><span class="s1">&#39;obs&#39;</span><span class="p">][</span><span class="s1">&#39;image&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">stacked_data</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">stacked_data</span><span class="p">[</span><span class="s1">&#39;reward&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">stacked_data</span><span class="p">[</span><span class="s1">&#39;done&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">B</span><span class="p">,)</span>
<span class="k">assert</span> <span class="n">stacked_data</span><span class="p">[</span><span class="s1">&#39;done&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">torch</span><span class="o">.</span><span class="n">bool</span>
</pre></div></td></tr></table></div>
</div>
<p>The output should be like below, and the assertion statements can be all passed.</p>
<div class="highlight-text notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span></pre></div></td><td class="code"><div><pre><span></span>{&#39;obs&#39;: {&#39;scalar&#39;: tensor([[-0.3270,  0.8859, -0.3521, -0.4243, -0.4983, -1.0030,  0.0209, -2.2713,
          0.2554,  0.2572,  0.3325, -0.1718],
        [-0.2645, -0.0340,  0.5842,  0.5161, -0.7758,  0.1067, -0.5435,  0.5538,
         -0.0257,  1.1946, -0.6314,  1.1059],
        [ 2.0467,  0.1206,  0.1839, -0.5025, -1.2742,  1.1108,  1.2381,  0.1886,
         -0.0358, -0.5211,  0.1213,  0.2039],
        [-0.1505, -0.2961, -1.0569,  0.5405,  0.2198, -1.1179, -0.8633,  0.3353,
         -0.9175,  1.3067, -0.8643, -0.3981]]), &#39;image&#39;: tensor([[[[-9.1161e-01,  1.5053e+00, -3.1637e-01,  ...,  1.8893e+00,
           -2.7324e-01, -1.3090e+00],
          [ 1.6492e+00,  1.2669e+00,  1.5482e+00,  ...,  3.7075e-01,
           -1.1550e+00, -8.6171e-01],
          [-2.7372e-01,  9.8253e-01, -1.0266e-01,  ..., -1.6621e+00,
            1.0777e+00, -7.4674e-01],
          ...,
          [ 4.2486e-01, -2.4929e-01, -1.8109e+00,  ..., -6.3112e-01,
           -8.4265e-01,  1.2455e+00],
          [ 7.6918e-01, -4.3410e-01, -7.3781e-01,  ...,  5.2902e-01,
           -7.5749e-01, -7.9220e-01],
          [-1.2780e-01, -2.3535e+00, -5.5528e-01,  ..., -1.7977e+00,
           -1.9906e-01, -7.6150e-02]],

         [[-1.1350e+00, -1.3682e+00,  1.1745e+00,  ..., -3.6819e-01,
           -1.3197e-01, -8.6177e-01],
          [-1.8179e+00,  7.4252e-01, -4.5668e-01,  ..., -4.6884e-01,
            7.0788e-01,  5.5322e-01],
          [ 9.9879e-01, -2.0491e+00, -7.6648e-01,  ..., -1.1572e+00,
           -5.4640e-01,  1.3379e+00],
          ...,
          [ 8.8405e-01, -8.4436e-01,  9.2651e-01,  ..., -1.4274e-01,
           -6.6396e-01,  8.6834e-01],
          [-6.8707e-01, -1.6103e+00, -7.7212e-01,  ...,  2.5057e-01,
            5.9633e-01,  6.7703e-01],
          [ 1.2042e+00,  5.9211e-01,  4.9942e-01,  ...,  2.6508e-01,
            6.7823e-01,  3.4360e+00]],

         [[-2.8941e-01, -8.3064e-02, -4.2878e-01,  ..., -3.8670e-01,
           -3.4115e-01, -5.5464e-01],
          [-8.8498e-01, -6.5244e-02, -9.6433e-02,  ...,  1.0390e-01,
           -1.1344e+00, -3.5542e-01],
          [ 1.0970e+00, -2.6618e-01, -9.2071e-01,  ...,  2.8350e-01,
            3.7170e-01, -1.2437e+00],
          ...,
          [ 3.7600e-01,  6.8148e-01, -7.0378e-02,  ..., -2.4266e-01,
            1.5212e+00,  1.0246e+00],
          [-2.5211e-01, -3.6618e-01, -5.9186e-02,  ..., -6.4439e-01,
            1.5652e+00, -1.9521e+00],
          [-1.0181e+00, -4.3583e-01, -1.0751e+00,  ..., -1.1960e+00,
           -2.0017e+00,  9.1913e-01]]],


        [[[ 6.7282e-01,  1.9797e+00,  1.6197e-01,  ...,  1.5868e+00,
           -9.8256e-01,  7.9203e-01],
          [ 3.8942e-01,  1.0410e+00,  2.2200e-02,  ..., -2.9977e-01,
           -3.1326e-01, -5.4149e-01],
          [-4.5248e-01, -1.2757e-01, -2.5681e-01,  ..., -7.5369e-01,
           -8.1703e-01, -1.0373e+00],
          ...,
          [-4.0644e-01, -2.8693e-01, -6.5571e-02,  ..., -5.1097e-01,
            2.3638e+00, -3.3878e-01],
          [ 9.4311e-01, -2.5556e-01, -1.7843e+00,  ..., -1.6957e-01,
           -6.7018e-01,  9.3339e-04],
          [-1.2323e-01,  8.3886e-01,  1.5358e+00,  ..., -6.0653e-02,
            1.8604e-01,  1.1761e+00]],

         [[ 2.5293e-01, -3.9304e-02, -9.5077e-01,  ...,  3.5625e-01,
            3.4355e-02,  2.1207e-01],
          [ 9.5239e-01,  1.6727e+00,  1.3200e+00,  ..., -5.4361e-01,
            1.8018e-01, -1.6508e-01],
          [ 6.8841e-01,  1.8519e-01, -1.3867e+00,  ..., -8.7007e-01,
           -1.2617e+00,  2.3160e-01],
          ...,
          [ 7.6510e-01, -5.8244e-02, -5.8912e-01,  ...,  2.7245e-01,
           -1.1490e+00,  1.2131e+00],
          [-3.6525e-01,  1.5987e+00, -2.8646e-01,  ...,  2.0375e+00,
            1.2915e+00,  1.3701e+00],
          [-2.9695e-01, -3.8157e-01,  1.5732e+00,  ...,  2.6547e-01,
           -1.5918e+00,  5.7054e-01]],

         [[ 6.1110e-03, -3.5495e-01, -2.8873e-01,  ..., -3.1302e-01,
           -8.6525e-01,  4.7430e-01],
          [ 5.8805e-01,  5.9752e-01,  2.1153e-02,  ...,  3.7927e-01,
            7.2984e-01,  1.5048e+00],
          [ 1.1144e+00,  1.2722e-01,  9.2285e-01,  ..., -1.7024e+00,
            1.6727e+00, -1.1733e+00],
          ...,
          [-3.8403e-01,  4.1955e-01,  1.7107e+00,  ...,  1.2507e+00,
            1.0967e+00,  2.4955e-01],
          [-2.4686e-01, -8.3297e-01, -6.5836e-01,  ..., -6.6544e-01,
            8.1950e-02, -2.4183e+00],
          [-6.7134e-01,  7.5649e-01, -2.2693e+00,  ..., -1.4919e-01,
            1.8903e-01, -4.3397e-01]]],


        [[[-9.1979e-01, -1.8959e+00, -1.1704e+00,  ...,  8.6860e-01,
            1.0726e+00, -2.0683e+00],
          [ 2.4383e-02,  7.8684e-01, -5.2577e-01,  ..., -2.2695e-02,
            1.0845e+00,  4.8682e-01],
          [-1.0622e+00, -4.1184e-01, -1.3206e-01,  ...,  1.7485e-01,
           -9.5153e-01,  6.3186e-01],
          ...,
          [-1.2645e+00,  1.9356e-01,  2.8847e-01,  ...,  8.6576e-01,
           -3.4580e-01, -1.0470e+00],
          [-6.0406e-01,  1.9884e+00, -4.5339e-02,  ...,  1.1265e+00,
            4.4108e-01,  2.1673e+00],
          [ 8.0417e-01,  2.2680e+00, -6.2462e-01,  ..., -5.4822e-01,
            8.1837e-02,  1.2242e+00]],

         [[-7.6493e-01,  1.3703e+00, -3.4866e-01,  ...,  5.8673e-01,
            2.2350e+00,  2.3171e-01],
          [-8.3166e-01, -9.4179e-01, -9.8482e-01,  ..., -5.1964e-02,
            9.4703e-01, -7.9815e-01],
          [ 1.4906e+00, -7.2758e-01,  1.9887e+00,  ..., -2.1819e-01,
            1.3174e+00, -2.0616e-01],
          ...,
          [ 8.4923e-01,  5.7363e-01, -9.2785e-01,  ..., -4.4515e-01,
            4.5250e-01, -9.9103e-01],
          [-9.5051e-01,  4.4910e-01, -1.2944e+00,  ...,  1.1115e+00,
           -4.6308e-01, -4.4435e-01],
          [-4.9447e-01, -2.8155e-01, -2.1932e+00,  ...,  1.5051e-03,
           -4.0447e-01,  9.8518e-01]],

         [[-6.1937e-02, -1.6449e-01, -6.4345e-01,  ..., -9.6018e-01,
           -3.2423e+00, -6.4115e-02],
          [ 1.1393e-01,  3.1667e-02,  2.5597e-01,  ...,  9.2448e-01,
           -2.1923e-01,  3.2804e-01],
          [-1.5611e+00,  2.7048e-01, -1.7021e-01,  ..., -1.1758e-01,
           -3.6906e-02,  3.7415e-01],
          ...,
          [-1.7548e+00, -2.7655e-01, -9.4139e-01,  ..., -6.6287e-01,
            9.7545e-01, -1.6410e+00],
          [-1.0220e+00,  1.0437e+00,  1.1954e+00,  ...,  4.7584e-01,
            5.2714e-01,  1.0209e+00],
          [-1.0078e+00, -8.0875e-02,  7.9459e-01,  ...,  1.6887e-01,
           -9.6803e-01,  3.1869e-01]]],


        [[[ 1.4277e+00,  7.0645e-01, -5.3907e-01,  ...,  2.0656e-01,
           -2.2309e-01, -4.3733e-01],
          [ 1.0068e+00,  2.9672e-01, -3.9426e-01,  ...,  6.7884e-01,
            1.2154e-01, -5.9709e-01],
          [-2.8579e-02,  9.5999e-01, -5.7672e-01,  ...,  1.1540e+00,
           -4.6649e-01,  7.0854e-01],
          ...,
          [-2.0075e-01,  1.1653e+00, -2.0113e-01,  ...,  3.1143e-01,
           -1.0405e+00, -1.9425e-01],
          [-2.8064e-01,  1.2352e-01, -1.4152e+00,  ...,  1.3552e+00,
            4.5358e-01,  2.1172e+00],
          [-7.1474e-02, -4.7539e-01,  1.3858e-01,  ...,  1.2170e+00,
            1.1148e+00,  2.8007e-01]],

         [[ 1.2826e-01,  3.1936e-01,  5.4359e-01,  ...,  1.2576e+00,
            1.1527e+00,  7.1407e-01],
          [ 1.3583e+00,  4.0740e-01,  2.1892e+00,  ...,  6.1349e-02,
           -4.2099e-01,  4.9625e-01],
          [-3.7594e-01, -1.4711e-01, -9.8024e-02,  ..., -5.2643e-01,
            1.4812e-01, -2.8775e-01],
          ...,
          [-5.3096e-01, -5.8163e-01,  9.2548e-01,  ...,  1.7909e+00,
           -6.3227e-01, -7.1623e-01],
          [-3.2975e-02, -4.3400e-01, -2.9403e-01,  ..., -3.3994e-02,
            1.0167e+00,  2.4441e+00],
          [-4.6281e-01, -7.2946e-01, -8.3711e-01,  ..., -2.3084e-02,
            1.0378e+00,  4.3868e-01]],

         [[ 1.2163e+00,  1.3486e+00, -6.4573e-02,  ...,  1.1006e+00,
            1.0975e+00, -2.0090e+00],
          [-1.6790e+00, -1.1448e+00, -1.1686e-01,  ...,  4.2767e-03,
            7.5158e-01, -5.3276e-01],
          [ 1.4362e+00,  4.0303e-01,  5.6519e-01,  ..., -1.7301e+00,
            1.4653e+00,  1.0019e+00],
          ...,
          [ 2.2310e+00,  1.6360e-01,  1.2897e+00,  ..., -1.3971e+00,
            1.8322e-01,  4.3967e-02],
          [-9.3482e-01, -7.1484e-01, -8.4050e-01,  ...,  1.2938e-01,
            5.9264e-01,  4.1219e-02],
          [-1.4739e+00, -1.2240e+00,  2.1792e+00,  ...,  1.3541e+00,
           -1.6772e+00,  7.2080e-01]]]])}, &#39;action&#39;: tensor([[1],
        [5],
        [8],
        [8]]), &#39;reward&#39;: tensor([[0.5867],
        [0.0397],
        [0.3948],
        [0.4266]]), &#39;done&#39;: tensor([False, False, False, False])}
</pre></div></td></tr></table></div>
</div>
<p>We can see that the structure process function need to be fully implemented (like the function <code class="docutils literal notranslate"><span class="pre">stack</span></code>). This code is actually not clear, and due to hard coding, if you need to support more data types (such as integer), you must make special modifications to the function.</p>
</section>
<section id="stack-with-treetensor-api">
<h2>Stack With TreeTensor API<a class="headerlink" href="#stack-with-treetensor-api" title="Permalink to this headline">¶</a></h2>
<p>The same workflow can be implemented with treetensor API like the code below.</p>
<div class="highlight-python notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="kn">import</span> <span class="nn">treetensor.torch</span> <span class="k">as</span> <span class="nn">ttorch</span>

<span class="n">B</span> <span class="o">=</span> <span class="mi">4</span>


<span class="k">def</span> <span class="nf">get_item</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;obs&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;scalar&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">12</span><span class="p">),</span>
            <span class="s1">&#39;image&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span>
        <span class="p">},</span>
        <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,)),</span>
        <span class="s1">&#39;reward&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
        <span class="s1">&#39;done&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">}</span>


<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_item</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">B</span><span class="p">)]</span>
<span class="c1"># execute `stack` op</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">ttorch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
<span class="n">stacked_data</span> <span class="o">=</span> <span class="n">ttorch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># validate</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stacked_data</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">stacked_data</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">stacked_data</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">stacked_data</span><span class="o">.</span><span class="n">reward</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">stacked_data</span><span class="o">.</span><span class="n">done</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">B</span><span class="p">,)</span>
<span class="k">assert</span> <span class="n">stacked_data</span><span class="o">.</span><span class="n">done</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">torch</span><span class="o">.</span><span class="n">bool</span>
</pre></div></td></tr></table></div>
</div>
<p>The output should be like below, and the assertion statements can be all passed as well.</p>
<div class="highlight-text notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span></pre></div></td><td class="code"><div><pre><span></span>&lt;Tensor 0x7fbf103643d0&gt;
├── &#39;action&#39; --&gt; tensor([[0],
│                        [1],
│                        [8],
│                        [4]])
├── &#39;done&#39; --&gt; tensor([False, False, False, False])
├── &#39;obs&#39; --&gt; &lt;Tensor 0x7fbf10364410&gt;
│   ├── &#39;image&#39; --&gt; tensor([[[[ 2.0821e+00,  1.0016e+00, -6.4209e-01,  ..., -2.7939e+00,
│   │                           7.4566e-01, -6.2915e-01],
│   │                         [-1.0129e+00,  1.5374e-01, -2.1874e+00,  ...,  8.7775e-01,
│   │                          -4.7107e-01, -7.3392e-02],
│   │                         [ 1.0927e-01, -2.6843e-01,  2.3628e+00,  ...,  4.4298e-01,
│   │                           2.9872e+00, -1.3232e-01],
│   │                         ...,
│   │                         [-1.2541e+00,  2.1521e-02,  4.8028e-01,  ..., -1.7689e-01,
│   │                          -2.7573e-01,  1.4838e+00],
│   │                         [-4.2071e-01, -4.5554e-01, -5.2050e-01,  ...,  3.2863e-01,
│   │                          -7.5692e-01, -2.1471e-01],
│   │                         [ 1.7812e+00,  1.1798e-01, -9.7530e-01,  ..., -2.2025e-01,
│   │                          -4.8471e-01,  2.0467e-02]],
│   │               
│   │                        [[ 6.8102e-01,  1.3823e-01,  2.3468e+00,  ..., -1.1212e-01,
│   │                           3.6772e-01,  6.0334e-01],
│   │                         [ 1.7480e+00, -1.8505e-01,  2.2302e+00,  ..., -1.3532e+00,
│   │                           1.6276e+00,  3.9370e-01],
│   │                         [-5.7663e-02,  4.8409e-01, -1.4258e+00,  ...,  2.2756e-01,
│   │                           1.7318e-02,  7.6812e-02],
│   │                         ...,
│   │                         [-1.0566e+00,  7.5563e-01, -1.3805e+00,  ...,  7.2871e-01,
│   │                           4.1683e-01,  3.6139e-01],
│   │                         [ 8.0457e-03,  1.7754e-01,  2.0578e+00,  ...,  1.0243e+00,
│   │                           9.3800e-01, -1.7101e-01],
│   │                         [ 5.6393e-01, -2.4221e-01, -2.5545e-02,  ..., -5.5691e-01,
│   │                           1.7781e+00,  1.7883e-01]],
│   │               
│   │                        [[ 4.8526e-01, -1.2090e+00,  1.1942e+00,  ..., -1.1361e+00,
│   │                           1.1336e+00,  1.6086e+00],
│   │                         [-1.0650e+00, -7.1060e-01, -1.2547e+00,  ...,  9.8036e-01,
│   │                          -6.1765e-01, -1.0293e+00],
│   │                         [-2.7653e-01,  1.8285e-01, -1.1745e+00,  ..., -1.1441e+00,
│   │                           1.3090e-04,  9.8310e-02],
│   │                         ...,
│   │                         [-5.4494e-01,  3.6760e-01,  1.5679e+00,  ..., -2.8964e-01,
│   │                          -9.3516e-01,  3.6531e-01],
│   │                         [ 1.0627e+00,  2.6950e-01, -2.5003e-01,  ..., -1.0978e-01,
│   │                          -1.4845e+00, -2.1137e+00],
│   │                         [-9.1251e-02, -4.3558e-01, -4.8904e-01,  ..., -1.2933e+00,
│   │                           2.5313e-01, -5.4313e-02]]],
│   │               
│   │               
│   │                       [[[ 1.4735e+00,  6.0010e-01,  4.0906e-01,  ...,  1.1364e+00,
│   │                          -5.8882e-01,  1.1624e+00],
│   │                         [-4.9359e-01, -2.5421e-01,  1.1702e+00,  ..., -3.0620e-01,
│   │                          -6.4229e-01,  3.6210e-01],
│   │                         [ 4.3590e-01, -1.5048e+00, -3.4215e-01,  ..., -3.2719e-01,
│   │                          -6.0109e-01,  1.0317e+00],
│   │                         ...,
│   │                         [-5.1269e-01, -1.3115e-01,  5.1068e-01,  ...,  4.7381e-01,
│   │                          -2.8521e+00, -9.9387e-02],
│   │                         [-9.5816e-01,  8.7087e-02,  4.1444e-01,  ..., -2.4416e-01,
│   │                           8.7023e-01,  1.0577e+00],
│   │                         [-1.5296e+00, -5.4429e-01,  4.3821e-01,  ...,  1.4024e+00,
│   │                           4.5974e-01,  7.4202e-01]],
│   │               
│   │                        [[-5.9109e-01,  1.4793e-01,  3.9669e-01,  ..., -1.7893e+00,
│   │                           4.2753e-01, -1.7025e+00],
│   │                         [ 1.0331e+00,  9.7353e-01,  2.8687e-01,  ...,  1.3573e-01,
│   │                          -9.9490e-02,  5.4461e-01],
│   │                         [-1.7518e+00, -8.7438e-01,  6.0946e-01,  ...,  4.3093e-02,
│   │                           1.8865e-01, -1.0235e-01],
│   │                         ...,
│   │                         [-1.7131e+00, -2.1833e+00,  2.7537e-01,  ...,  1.9496e-01,
│   │                           3.5608e-01, -7.9234e-01],
│   │                         [ 2.3539e-01,  7.7529e-02, -2.4198e+00,  ...,  4.0755e-01,
│   │                          -2.7986e-01,  8.3459e-01],
│   │                         [ 8.4559e-02, -8.8850e-02, -5.8060e-01,  ...,  1.6573e+00,
│   │                           1.3137e-01, -4.0436e-01]],
│   │               
│   │                        [[-4.1357e-01, -9.6014e-01, -2.2679e+00,  ..., -6.9641e-01,
│   │                          -1.3983e+00,  1.6308e+00],
│   │                         [-4.3019e-01,  2.1839e-01, -2.3196e-01,  ...,  1.5478e+00,
│   │                           8.7122e-01, -9.5366e-01],
│   │                         [ 1.3452e+00, -5.6321e-01, -1.4008e+00,  ...,  1.0205e+00,
│   │                           5.9273e-01, -2.7066e-01],
│   │                         ...,
│   │                         [-1.1254e+00,  6.1692e-01,  6.8238e-01,  ..., -8.4594e-02,
│   │                          -1.5350e+00, -8.6319e-01],
│   │                         [-4.5670e-01,  2.1371e-01,  1.1471e+00,  ..., -1.6252e+00,
│   │                          -1.6227e+00, -1.8857e-01],
│   │                         [ 5.3443e-01, -7.0895e-01, -6.3852e-01,  ..., -8.9924e-01,
│   │                           7.9678e-01,  1.7416e+00]]],
│   │               
│   │               
│   │                       [[[-1.5233e+00,  6.8537e-01, -9.0955e-01,  ..., -4.5255e-01,
│   │                          -6.4697e-01,  1.9335e+00],
│   │                         [-3.3943e-01, -1.7613e-01, -1.8467e-01,  ..., -6.4935e-01,
│   │                          -4.9320e-01,  1.2809e+00],
│   │                         [ 8.3311e-01, -7.1096e-02,  7.7428e-01,  ...,  6.6128e-01,
│   │                           6.9927e-01, -1.1300e+00],
│   │                         ...,
│   │                         [ 1.3916e+00,  4.4936e-01,  1.4486e+00,  ...,  1.3811e+00,
│   │                           6.1877e-02,  9.1742e-01],
│   │                         [-1.3908e+00, -3.5878e-01, -8.7909e-03,  ...,  2.3689e-01,
│   │                          -3.1738e-01, -7.7874e-02],
│   │                         [ 3.1231e+00, -6.5852e-01,  1.2499e+00,  ..., -5.0848e-01,
│   │                           1.3643e+00,  5.5520e-02]],
│   │               
│   │                        [[ 2.5251e-01, -5.7860e-03,  8.7754e-01,  ..., -8.2432e-01,
│   │                           2.2193e-01,  3.9421e-01],
│   │                         [-2.1847e+00,  5.3373e-03, -1.8687e+00,  ...,  3.3087e-01,
│   │                          -4.4937e-01,  9.9722e-01],
│   │                         [ 2.8673e-02,  5.4045e-02, -1.3103e+00,  ...,  2.0394e-01,
│   │                           9.8982e-01,  1.8236e+00],
│   │                         ...,
│   │                         [ 1.2163e+00, -1.2191e+00, -6.2569e-01,  ..., -1.5878e+00,
│   │                           9.2783e-01,  7.9006e-01],
│   │                         [ 1.2276e+00,  1.5695e+00, -4.2698e-01,  ...,  1.2748e+00,
│   │                          -8.1379e-01, -3.7423e-01],
│   │                         [ 2.3876e-01, -1.2212e+00,  1.1451e+00,  ...,  2.2714e-01,
│   │                           8.3597e-01,  1.2526e+00]],
│   │               
│   │                        [[ 7.5329e-02, -7.8845e-01, -4.2255e-01,  ...,  2.1025e+00,
│   │                           9.1306e-01, -3.4391e-01],
│   │                         [ 2.9082e-01,  8.8240e-01, -1.3992e+00,  ..., -1.5582e-01,
│   │                           1.4883e-01,  1.3299e+00],
│   │                         [-3.2923e+00, -4.4377e-01,  9.7847e-02,  ...,  6.0294e-01,
│   │                          -5.9925e-02,  2.7128e-01],
│   │                         ...,
│   │                         [-3.8918e-01,  8.3673e-01, -9.7199e-01,  ..., -2.4272e-01,
│   │                          -3.8789e-01, -2.1690e+00],
│   │                         [ 5.9599e-01,  8.3342e-03,  6.2347e-01,  ..., -1.5282e+00,
│   │                           1.6195e+00, -3.9260e-01],
│   │                         [ 1.1812e+00,  8.5101e-01, -9.9777e-01,  ...,  2.0145e+00,
│   │                           4.3656e-01,  5.9410e-02]]],
│   │               
│   │               
│   │                       [[[-6.6820e-01, -6.1730e-01, -7.5293e-01,  ...,  5.6400e-01,
│   │                          -9.4889e-01, -9.9105e-01],
│   │                         [ 1.0785e-01,  4.2812e-01, -3.5536e-01,  ..., -1.4208e+00,
│   │                          -2.1981e-01, -2.4721e-01],
│   │                         [ 6.5050e-01, -2.5163e-01,  6.9212e-01,  ..., -9.3035e-04,
│   │                          -1.5881e+00, -1.4874e+00],
│   │                         ...,
│   │                         [ 3.2279e-01,  1.5255e+00, -1.3949e-01,  ..., -2.4820e-01,
│   │                          -1.1437e-01, -1.4009e+00],
│   │                         [ 5.3399e-01,  5.4663e-01, -8.2980e-01,  ..., -4.9973e-01,
│   │                           1.9893e+00, -5.6480e-02],
│   │                         [ 3.0481e-01, -1.6504e+00,  3.9902e-01,  ...,  3.3284e-01,
│   │                          -2.5326e-01,  5.2361e-01]],
│   │               
│   │                        [[-8.6366e-01,  1.0951e+00, -4.1669e-02,  ..., -2.7490e-01,
│   │                           3.6085e-01, -1.0950e+00],
│   │                         [-4.8423e-01,  8.8997e-01, -6.9260e-01,  ..., -2.3574e-01,
│   │                          -7.3459e-02, -5.9574e-01],
│   │                         [-1.3662e+00, -1.2241e+00,  5.2346e-01,  ...,  1.9891e+00,
│   │                           5.8368e-01,  4.5294e-01],
│   │                         ...,
│   │                         [ 1.8311e+00, -4.2246e-02, -5.4536e-01,  ..., -1.5299e+00,
│   │                           1.0564e+00, -2.0450e-01],
│   │                         [-1.6157e+00,  1.0973e+00,  1.9842e+00,  ...,  6.6477e-01,
│   │                           6.4181e-01,  9.2281e-01],
│   │                         [ 3.8698e-02,  1.9414e+00,  2.3095e-01,  ..., -1.0166e+00,
│   │                           1.4722e+00, -4.7261e-01]],
│   │               
│   │                        [[-1.2866e-01, -2.3166e-01, -3.0072e-01,  ...,  5.9993e-01,
│   │                          -7.9473e-01,  9.0898e-01],
│   │                         [ 3.9148e-02,  6.4062e-01, -2.1040e+00,  ..., -7.0298e-01,
│   │                          -1.8679e+00, -8.4966e-02],
│   │                         [-9.3039e-01, -3.0924e+00, -1.3796e+00,  ..., -1.4866e+00,
│   │                           1.3932e+00,  1.0757e+00],
│   │                         ...,
│   │                         [ 4.6044e-01,  9.7770e-01, -8.8562e-01,  ...,  1.8256e+00,
│   │                           3.9618e-01,  1.2541e+00],
│   │                         [ 9.6914e-01, -9.3936e-01,  5.6102e-02,  ..., -8.3290e-02,
│   │                           1.6562e-01,  1.4461e-01],
│   │                         [ 1.4647e-01,  9.1946e-01, -1.3928e+00,  ...,  9.6140e-01,
│   │                           2.4751e-01,  7.6158e-01]]]])
│   └── &#39;scalar&#39; --&gt; tensor([[-1.2763, -0.4234,  2.0120, -1.7000,  0.3411, -1.0186, -1.5300,  0.9418,
│                              0.2060,  1.2063, -0.3591,  0.7101],
│                            [-1.0719, -1.2381, -0.9163,  0.8518, -1.8688,  0.8413,  0.6273, -0.3578,
│                              0.4235,  0.4812, -1.3919, -1.2172],
│                            [-0.9742, -1.8155, -1.1602,  0.8124, -1.1264, -1.2981,  0.6173, -3.1806,
│                              0.4334,  0.6035,  1.3969, -0.0902],
│                            [-0.2556,  0.2091, -0.9808,  0.6613,  0.3293, -0.5040, -0.3456,  0.7954,
│                             -1.8692,  0.9882,  0.0828,  0.0147]])
└── &#39;reward&#39; --&gt; tensor([[0.5395],
                         [0.7336],
                         [0.6966],
                         [0.3005]])
</pre></div></td></tr></table></div>
</div>
<p>This code looks much simpler and clearer.</p>
</section>
</section>



           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../operation/index.html" class="btn btn-neutral float-right" title="Customized Operations For Different Fields" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../../tutorials/plugins/index.html" class="btn btn-neutral float-left" title="Plugins" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2022, HansBug, DI-engine&#39;s Contributors

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
    <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: v0.2.1
    <span class="fa fa-caret-down"></span>
  </span>
        <div class="rst-other-versions">
                <dl>
                    <dt>Tags</dt>
                        <dd><a href="index.html">v0.2.1</a></dd>
                        <dd><a href="../../../v0.3.0/best_practice/stack/index.html">v0.3.0</a></dd>
                </dl>
                <dl>
                    <dt>Branches</dt>
                        <dd><a href="../../../12/merge/best_practice/stack/index.html">12/merge</a></dd>
                        <dd><a href="../../../dev/stream/best_practice/stack/index.html">dev/stream</a></dd>
                        <dd><a href="../../../main/best_practice/stack/index.html">main</a></dd>
                        <dd><a href="../../../run/xdemos/best_practice/stack/index.html">run/xdemos</a></dd>
                        <dd><a href="../../../test/os/best_practice/stack/index.html">test/os</a></dd>
                </dl>
        </div>
    </div>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>